/**
 * Path 2: The Sacred Breath - 聖息 (Shèng Xī) (Canonically Refactored)
 * 
 * Path Philosophy: "Air connects all life. To master the breath is to feel the chi of the world and to see the unseen."
 * Essence: Spiritual connection, sensing chi, meditation, non-combat support.
 */
import type { TalentNode, TalentConnection, NodeType } from '../../types';
import { getAirNodeIcon } from './airNodeIcons';

const CENTER_X = 0, CENTER_Y = 0, BRANCHES = 2;
const PATH_MAIN_ANGLE = Math.PI, ANGLE_SPREAD = Math.PI / 2.5; // Pointing LEFT
const ANGLE_START = PATH_MAIN_ANGLE - (ANGLE_SPREAD / 2);
const BASE_RADIUS = 220, RADIUS_STEP = 160, MIN_DIST = 100;

const nodeDataList=[{id:'genesis',name:'The Sacred Breath Path',type:'Genesis',cost:1,branch:0,depth:0,description:"You gain a deeper spiritual awareness. You are taught that all Air Nomads are born airbenders due to this strong spiritual connection.",flavor:"To master the breath is to understand the unity of existence."},{id:'minor_genesis_1',name:'Heat Regulation',type:'Minor',cost:1,branch:0.8,depth:0.5,prerequisite:'genesis',description:"You are able to warm yourself using proper breathing techniques, allowing you to thrive in frigid environments with ease.",flavor:"The breath is the body's hearth."},{id:'minor_genesis_2',name:'Sound Manipulation',type:'Minor',cost:1,branch:1.2,depth:0.5,prerequisite:'genesis',description:"You can manipulate sound to throw your voice as a distraction or to trick someone.",flavor:"The wind carries whispers."},{id:'sb_minor_1',name:'Deeper Calm',type:'Minor',cost:1,branch:1.2,depth:0.7,prerequisite:'genesis',description:"Your meditative breathing strengthens your inner chi, granting a natural resistance to negative emotional influences.",flavor:"A tranquil mind is a strong fortress."},{id:'sb_minor_2',name:'Focused Hearing',type:'Minor',cost:1,branch:1,depth:1.5,prerequisite:'sound_amplification',description:"You can focus your hearing with the wind, picking up distant conversations.",flavor:"The wind carries all secrets."},{id:'sb_minor_3',name:'Spiritual Resonance',type:'Minor',cost:1,branch:0,depth:1.5,prerequisite:'hypersensitivity',description:"You are more easily able to sense the presence of spirits nearby.",flavor:"The veil between worlds grows thin."},{id:'sb_minor_4',name:'Echoes of the Past',type:'Minor',cost:1,branch:0,depth:2.5,prerequisite:'breath_of_wind',description:"When using Breath of Wind on an old object, you gain a faint impression of its previous owner.",flavor:"The air remembers all it has touched."},{id:'sb_minor_5',name:'Harmonious Aura',type:'Minor',cost:1,branch:0.2,depth:3.5,prerequisite:'spiritual_projection',description:"Friendly spirits are more receptive to your presence.",flavor:"Peace is a language all spirits understand."},{id:'sb_minor_6',name:'Resonant Echoes',type:'Minor',cost:1,branch:-0.2,depth:1.5,prerequisite:'clarity_meditation',description:"You not only sense location, but also gain a vague impression of numbers and size.",flavor:"The air vibrates with the presence of many."},{id:'sb_minor_7',name:'Lingering Imprint',type:'Minor',cost:1,branch:0.2,depth:1.5,prerequisite:'clarity_meditation',description:"The sense of where things were remains in your mind for a few moments after you stop meditating.",flavor:"The wind remembers every movement."},{id:'sb_minor_8',name:'Emotional Echo',type:'Minor',cost:1,branch:-0.2,depth:2.5,prerequisite:'memory_of_air',description:"You gain a much clearer sense of the emotions tied to the memory.",flavor:"The air carries feelings as well as sound."},{id:'sb_minor_9',name:'Hallowed Ground',type:'Minor',cost:1,branch:0.2,depth:2.5,prerequisite:'memory_of_air',description:"When used in a place of strong spiritual power, your visions become clearer and can show events from much further in the past.",flavor:"Sacred places hold the deepest echoes."},{id:'sb_minor_10',name:'Shared Sight',type:'Minor',cost:1,branch:0.8,depth:3.5,prerequisite:'B3',description:"For a brief moment, you can share what one bonded member sees with the others.",flavor:"The spirit sees through all barriers."},{id:'hypersensitivity',name:'Hypersensitivity',type:'Keystone',cost:2,branch:0,depth:1,prerequisite:'genesis',description:"By shaving your head, you free yourself to perceive subtle shifts in the surrounding air currents, giving you a split-second increase in reaction time.",flavor:"We airbenders learn to feel the energy behind the wind, not just the breeze on our skin."},{id:'minor_hs_1',name:"Sense the Blow's Wake",type:'Minor',cost:1,branch:-0.2,depth:1.5,prerequisite:'hypersensitivity',description:"You can attune yourself to the ebb and flow of the wind around you, becoming aware of incoming attacks to respond instantly.",flavor:"The air speaks before the strike."},{id:'breath_of_wind',name:'Breath of Wind',type:'Manifestation',cost:4,branch:0,depth:2,prerequisite:'hypersensitivity',description:"You create an air jet directly from your mouth and lungs, requiring excellent breath control. Its size and focus are easily controlled.",flavor:"The breath is the first and final tool."},{id:'minor_bow_1',name:'Cooling Gust',type:'Minor',cost:1,branch:-0.2,depth:2.5,prerequisite:'breath_of_wind',description:"Your Breath of Wind is powerful enough to cool magma into solidified rock.",flavor:"As demonstrated by Avatar Roku."},{id:'spiritual_projection',name:'Spiritual Projection',type:'Axiom',cost:5,branch:0,depth:3,prerequisite:'breath_of_wind',description:"Through deep meditation, you project your spirit out of your physical body. Your spirit is invisible and can travel freely to scout, observe, and pass through solid matter.",flavor:"A technique mastered by Jinora through her strong spiritual connection."},{id:'minor_a3_1',name:'Ethereal Cloak',type:'Minor',cost:1,branch:0,depth:3.5,prerequisite:'spiritual_projection',description:"You learn to mask your spiritual presence, making you harder to detect by hostile or wary spirits.",flavor:"The spirit's journey knows no bounds."},{id:'minor_a3_2',name:'Spirit Anchor',type:'Minor',cost:1,branch:-0.2,depth:3.5,prerequisite:'spiritual_projection',description:"You can create a spiritual 'beacon' on your physical body, making it easier to find your way back from distant or disorienting spiritual locations.",flavor:"The spirit sees through all barriers."},{id:'sound_amplification',name:'Sound Amplification',type:'Keystone',cost:2,branch:1,depth:1,prerequisite:'genesis',description:"By using Breath of Wind, you can magnify the sound waves generated by a whistle or another instrument to a massive degree.",flavor:"As used by Aang to call all the animals in Ba Sing Se."},{id:'minor_sa_1',name:'Deafening Shout',type:'Minor',cost:1,branch:0.8,depth:1.5,prerequisite:'sound_amplification',description:"You can enhance your own voice to create airbending-powered screams that can deafen opponents.",flavor:"A technique used by Avatar Yangchen."},{id:'minor_b1_2',name:"Nature's Bond",type:'Minor',cost:1,branch:0.8,depth:1.5,prerequisite:'sound_amplification',description:"This calming influence is particularly effective on creatures naturally attuned to the air, like Sky Bison or Flying Lemurs, allowing for a deeper connection.",flavor:"The spirit's touch reaches deep."},{id:'B2',name:'Guiding Light',type:'Manifestation',cost:4,branch:1,depth:2,prerequisite:'sound_amplification',description:"You can manifest your own spiritual energy as a visible, gentle light. This light can guide others through darkness, pacify angry minor spirits, and reveal 'dark' or corrupting spiritual influences as shadowy stains on the world.",flavor:"The air remembers all it has touched."},{id:'minor_b2_1',name:'Purifying Breath',type:'Minor',cost:1,branch:1,depth:2.5,prerequisite:'B2',description:"By gently blowing your guiding light onto a person or small area, you can help cleanse them of negative spiritual energy (e.g., after contact with a dark spirit).",flavor:"The past speaks clearly to those who listen."},{id:'minor_b2_2',name:'Spirit Bridge',type:'Minor',cost:1,branch:0.8,depth:2.5,prerequisite:'B2',description:"Spirits are more willing and able to communicate with you when you manifest your light, making you a clearer conduit for their messages.",flavor:"Feel what the object has felt."},{id:'B3',name:'Breath of Kinship',type:'Axiom',cost:5,branch:1,depth:3,prerequisite:'B2',description:"You learn to synchronize your breathing and chi with willing allies. This creates a tangible bond, allowing you to feel their emotional state, share stamina, and take a portion of their physical burden onto yourself, revitalizing them at a cost to your own energy.",flavor:"The mind is not bound by the body."},{id:'minor_b3_1',name:'Unity of Purpose',type:'Minor',cost:1,branch:1,depth:3.5,prerequisite:'B3',description:"When bonded, you and your allies move with greater coordination, as if anticipating each other's actions.",flavor:"The spirit's journey knows no bounds."},{id:'minor_b3_2',name:'Shared Sight',type:'Minor',cost:1,branch:0.8,depth:3.5,prerequisite:'B3',description:"For a brief moment, you can share what one bonded member sees with the others.",flavor:"The spirit sees through all barriers."}];
const nodes: TalentNode[] = [], connections: TalentConnection[] = [], nodeMap: Record<string, TalentNode> = {};
nodeDataList.forEach(d => {
  const p = Array.isArray(d.prerequisite) ? d.prerequisite : (d.prerequisite ? [d.prerequisite] : []);
  const a = ANGLE_START + (d.branch * ANGLE_SPREAD) / BRANCHES, r = BASE_RADIUS + RADIUS_STEP * d.depth;
  const x = d.type === 'Genesis' ? CENTER_X : Math.round(CENTER_X + r*Math.cos(a)), y = d.type==='Genesis' ? CENTER_Y : Math.round(CENTER_Y + r*Math.sin(a));
  const n:TalentNode={...d,id:d.id,path:'sacred_breath',constellation:'air',position:{x,y},prerequisites:p,visual:{color:'#E6E6FA',size:50,icon:getAirNodeIcon(d.id)},effects:[],isVisible:true,isAllocatable:!p.length,isAllocated:false,isLocked:!!p.length,isPermanentlyLocked:false,pkCost:d.cost,type:d.type as NodeType};
  nodes.push(n); nodeMap[n.id]=n; p.forEach(prereqId=>connections.push({from:prereqId,to:n.id,isActive:false,isLocked:false}));
});
export const SACRED_BREATH_NODES = nodes;
export function generateSacredBreathConnections(): TalentConnection[] { return connections; }
export const SACRED_BREATH_METADATA = { name: 'The Sacred Breath', philosophy: 'Air connects all life. To master the breath is to feel the chi of the world and to see the unseen.', essence: 'Spiritual connection, sensing chi, meditation, non-combat support.', focus: 'Spiritual awareness and connection to the spirit world, inspired by Jinora and Yangchen.', sacredAnimal: 'The Sky Bison', emoji: '🦬', color: '#e6e6fa', position: { x: 900, y: 550 } }; 