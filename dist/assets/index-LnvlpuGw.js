var G=Object.defineProperty;var j=(r,e,t)=>e in r?G(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>j(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const V={"grounds the soul in forgotten truths":["anchors the spirit in ancient wisdom","connects the heart to timeless knowledge","awakens memories of sacred teachings","reveals the depth of spiritual understanding"],"each bite is a silent prayer":["every taste becomes a meditation","each morsel carries sacred intention","every flavor whispers ancient blessings","each portion holds divine reverence"],"every flavor a ripple across time":["each taste echoing through eternity","every note resonating with the ages","each essence bridging past and present","every sensation touching the infinite"],"prepared only during":["crafted exclusively for","created solely during","reserved for the sacred","made only in honor of"],"the kitchen fills with":["the cooking space resonates with","the temple kitchen echoes with","the sacred space hums with","the preparation area vibrates with"],"chosen for cleansing ceremonies and purification rituals":["selected for their spiritual properties in sacred rites","gathered for their role in temple purification","chosen for their power in cleansing rituals","picked for their sacred significance in ceremonies"],"unfolds like ancient scrolls":["unfolds like morning mist","emerges like temple incense","develops like distant thunder","blooms like mountain flowers"],"the veil between worlds grows thin":["reality seems to shimmer and bend","the boundary between sacred and mundane dissolves","temporal boundaries blur into eternity","the material world fades into spirit"],"marks the sacred turning of seasons":["celebrates the cycle of renewal","honors the passage of celestial time","acknowledges the rhythm of temple life","embraces the flow of natural change"]},T={PHRASE_CACHE_SIZE_LIMIT:25,PROSE_CACHE_SIZE_LIMIT:30,FESTIVAL_CACHE_LIMIT:8},M=["Vow of Silence Retreat","Sky Bison Appreciation Ceremony","Wind Walker's Pilgrimage","Guru's Festival of Repose","Festival of Four Winds","Harmonic Convergence Feast","Monk's Awakening Festival","Temple Bells Celebration","Mountain Wind Ceremony","Sacred Air Nomad Gathering","Floating Meditation Retreat","Avatar's Remembrance Day","Eastern Temple Pilgrimage","Western Air Temple Festival","Northern Sanctuary Ceremony","Southern Temple Observance","Airbending Master's Conclave","Spirit World Communion","Prayer Flag Blessing","Cloud Dancing Festival"],Y=["During preparation, a mischievous lemur interrupted the sacred ritual, yet somehow the dish became even more divine. ","Legend tells that this recipe was discovered when a sky bison accidentally knocked over ingredient jars in the temple kitchen. ","Master Pathik once declared this dish 'impossible to ruin,' challenging novice cooks across all four temples. ","An ancient proverb warns: 'Those who rush this dish will taste only their own impatience.' ","Temple records note seven different arguments among elders about the proper preparation method. All were correct. ","It's said that Avatar Aang himself couldn't resist sneaking extra portions during meditation retreats. "];class Z{constructor(){h(this,"usageHistory",new Map);h(this,"maxHistoryLength",50)}recordUsage(e){this.usageHistory.has(e)||this.usageHistory.set(e,[]);const t=this.usageHistory.get(e);t.push(Date.now()),t.length>this.maxHistoryLength&&t.shift()}getWeightModifier(e,t=3e4){const n=this.usageHistory.get(e);if(!n||n.length===0)return 1;const i=Date.now(),a=n.filter(s=>i-s<t).length;return Math.max(.1,Math.pow(.5,a))}clearHistory(){this.usageHistory.clear()}}const R=new Z,X=[["in perfect peace","transcendent experience"],["gentle as sky bison breath","profound spiritual significance"],["temple atmosphere","spiritual growth and development"],["lovingly","transcendent"],["gentle","gentle"],["sacred","sacred"],["profound","transcendent"],["peaceful","serene"],["harmonious","balanced"]];function g(r,e=[],t=X){const n=r.map(o=>{let l=1;const c=e.filter(d=>d===o).length;l*=Math.pow(.3,c),l*=R.getWeightModifier(o);for(const d of e.slice(-3))for(const[y,w]of t)(o===y&&d===w||o===w&&d===y)&&(l*=.1);return{phrase:o,weight:l}}),i=n.reduce((o,l)=>o+l.weight,0);let a=Math.random()*i;for(const o of n)if(a-=o.weight,a<=0)return R.recordUsage(o.phrase),o.phrase;const s=n[n.length-1].phrase;return R.recordUsage(s),s}const J=["Awakens dormant chakras and aligns spiritual energy pathways throughout the body","Facilitates deep meditative states and enhances connection to universal consciousness","Purifies the aura and creates protective energetic boundaries against negative influences","Stimulates the third eye chakra and opens channels for intuitive wisdom reception","Balances the five elements within the body and harmonizes with natural cosmic rhythms","Echoes the ancient wisdom of Guru Pathik, bringing clarity to life's spiritual journey","Channels the serene energy of the Eastern Air Temple meditation halls during sunrise","Invokes the protective spirit of Appa, surrounding the eater with loyal, gentle strength","Resonates with the frequencies used by Air Nomad masters for levitation practice","Connects the consumer to the sacred wind currents that guide sky bison migration","Traditionally consumed during the Autumn Equinox to prepare for winter contemplation","Sacred to the Festival of Four Winds, when Air Nomads honor the cardinal directions","Blessed during the Sky Bison Appreciation Ceremony for harmony with flying companions","Prepared exclusively for the Day of Ascending, marking young airbenders' first flight","Ceremonially shared during the Vow of Silence retreats in mountain hermitages","Evokes memories of peaceful temple courtyards filled with cherry blossom petals","Reminds the soul of floating meditation sessions above cloud-covered peaks","Brings back the sensation of gentle mountain breezes during evening prayer","Recalls the laughter of young monks playing airball in temple gardens","Awakens ancestral memories of the first airbenders learning from flying bison"];class Q{constructor(){h(this,"proseFragments",new Set);h(this,"festivals",new Set);h(this,"phraseAlternatives",new Set)}selectUniqueFragment(e){const t=e.filter(i=>!this.proseFragments.has(i));if(t.length===0)return this.proseFragments.clear(),g([...e]);const n=g(t);if(this.proseFragments.add(n),this.proseFragments.size>T.PROSE_CACHE_SIZE_LIMIT){const i=Array.from(this.proseFragments)[0];this.proseFragments.delete(i)}return n}selectUniqueFestival(){const e=M.filter(n=>!this.festivals.has(n)),t=e.length>0?this.selectUniqueFragment(e):this.selectUniqueFragment(M);if(this.festivals.add(t),this.festivals.size>T.FESTIVAL_CACHE_LIMIT){const n=Array.from(this.festivals)[0];this.festivals.delete(n)}return t}selectUniquePhrase(e){const t=e.filter(i=>!this.phraseAlternatives.has(i));if(t.length===0)return this.phraseAlternatives.clear(),e[Math.floor(Math.random()*e.length)];const n=t[Math.floor(Math.random()*t.length)];if(this.phraseAlternatives.add(n),this.phraseAlternatives.size>T.PHRASE_CACHE_SIZE_LIMIT){const i=Array.from(this.phraseAlternatives)[0];this.phraseAlternatives.delete(i)}return n}insertWildcardEvent(e){if(Math.random()<.25){const t=this.selectUniqueFragment(Y),n=[e.indexOf(". ")+2,e.indexOf(", ")+2,e.indexOf(" while ")+1].filter(i=>i>1);if(n.length>0){const i=n[Math.floor(Math.random()*n.length)];return e.slice(0,i)+t+e.slice(i)}}return e}reset(){this.proseFragments.clear(),this.festivals.clear(),this.phraseAlternatives.clear()}softReset(){this.proseFragments.size>15&&Array.from(this.proseFragments).slice(0,10).forEach(t=>this.proseFragments.delete(t)),this.festivals.size>4&&Array.from(this.festivals).slice(0,2).forEach(t=>this.festivals.delete(t))}}class I{static findTechniqueLore(e,t){return e.find(n=>n.technique.toLowerCase()===t.toLowerCase())}static findIngredientSynergy(e,t,n){return e.find(i=>{const a=i.ingredients.some(o=>t.some(l=>l.toLowerCase().includes(o.toLowerCase())||o.toLowerCase().includes(l.toLowerCase()))),s=i.technique.toLowerCase()===n.toLowerCase();return a&&s})}static findLegendaryIngredientContext(e,t){return e.find(n=>n.ingredient.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(n.ingredient.toLowerCase()))}static findLocationLore(e,t){return e.find(n=>n.name.toLowerCase().includes(t.toLowerCase()))}}const K=[{name:"Eastern Air Temple",type:"temple",region:"eastern",specialties:["sunrise meditation","cherry blossom cuisine","wind current reading"],culturalFocus:["female airbenders","spiritual teaching","seasonal harmony"],historicalSignificance:10},{name:"Western Air Temple",type:"temple",region:"western",specialties:["inverted architecture","floating gardens","gravity-defying cooking"],culturalFocus:["male airbenders","architectural innovation","atmospheric manipulation"],historicalSignificance:10},{name:"Northern Air Temple",type:"temple",region:"northern",specialties:["technological innovation","mechanized preparation","steam-powered facilities"],culturalFocus:["adaptation","ingenuity","modern integration"],historicalSignificance:8},{name:"Southern Air Temple",type:"temple",region:"southern",specialties:["peaceful meditation","sky bison bonding","pure tradition"],culturalFocus:["contemplation","animal harmony","ancient ways"],historicalSignificance:10},{name:"Guru Pathik's Hermitage",type:"sacred_site",region:"eastern",specialties:["chakra alignment","onion and banana juice","spiritual cleansing"],culturalFocus:["enlightenment","energy work","mystical preparation"],historicalSignificance:9},{name:"Sky Bison Sanctuary",type:"sanctuary",region:"wandering",specialties:["sky bison care","aerial cooking","migration food"],culturalFocus:["animal bonding","nomadic lifestyle","freedom"],historicalSignificance:9},{name:"Windswept Peaks Monastery",type:"monastery",region:"northern",specialties:["high-altitude preparation","mountain herbs","extreme weather cooking"],culturalFocus:["endurance","simplicity","elemental harmony"],historicalSignificance:7},{name:"Cloud Walker Temple",type:"temple",region:"wandering",specialties:["aerial meditation","cloud harvesting","wind-powered kitchens"],culturalFocus:["freedom","wandering","sky mastery"],historicalSignificance:8},{name:"Avatar Yangchen Memorial Pavilion",type:"sacred_site",region:"eastern",specialties:["historical recipes","diplomatic cuisine","peace offerings"],culturalFocus:["diplomacy","history","cultural exchange"],historicalSignificance:10}],ee=[{name:"Festival of Four Winds",season:"autumn",purpose:"Honor the cardinal directions and their spiritual significance",traditionalFoods:["wind-aligned dishes","directional spice blends","compass-rose cakes"],spiritualFocus:["balance","direction","cosmic harmony"],participants:["all air nomads","sky bison","wind spirits"],rarity:"common"},{name:"Day of Ascending",season:"spring",purpose:"Celebrate young airbenders' first solo flight",traditionalFoods:["lightness-inducing meals","floating desserts","sky-blue beverages"],spiritualFocus:["growth","achievement","freedom"],participants:["young airbenders","mentors","sky bison"],rarity:"uncommon"},{name:"Sky Bison Appreciation Ceremony",season:"summer",purpose:"Honor the sacred bond between airbenders and sky bison",traditionalFoods:["sky bison favorite treats","shared meals","harmony dishes"],spiritualFocus:["companionship","gratitude","interspecies bond"],participants:["airbenders","sky bison herds"],rarity:"common"},{name:"Guru's Festival of Repose",season:"winter",purpose:"Deep meditation retreat honoring spiritual masters",traditionalFoods:["meditation-enhancing broths","chakra-aligned meals","cleansing teas"],spiritualFocus:["introspection","wisdom","spiritual growth"],participants:["spiritual gurus","advanced masters","seekers"],rarity:"rare"},{name:"Monk's Awakening Festival",season:"spring",purpose:"Celebrate spiritual enlightenment and new understanding",traditionalFoods:["clarity-bringing dishes","awakening spices","enlightenment desserts"],spiritualFocus:["awakening","realization","consciousness"],participants:["monks","spiritual students","enlightened masters"],rarity:"uncommon"},{name:"Bison's Reverie",season:"autumn",purpose:"Sky bison meditation and bonding ceremony",traditionalFoods:["reverie cakes","dreaming teas","bonding treats"],spiritualFocus:["dreams","connection","peaceful rest"],participants:["sky bison","their airbender partners","sleep spirits"],rarity:"uncommon"},{name:"Harmonic Convergence Feast",season:"year_round",purpose:"Rare cosmic alignment celebration",traditionalFoods:["spirit world delicacies","cosmic alignment dishes","energy fusion meals"],spiritualFocus:["cosmic unity","spiritual convergence","world balance"],participants:["all airbenders","spirits","avatars"],rarity:"legendary"},{name:"Vow of Silence Retreat",season:"winter",purpose:"Silent meditation and contemplation period",traditionalFoods:["simple sustenance","quiet preparation","wordless sharing"],spiritualFocus:["silence","inner listening","profound peace"],participants:["contemplative monks","hermits","serious students"],rarity:"rare"},{name:"Wind Walker's Pilgrimage",season:"summer",purpose:"Journey to sacred sites across the world",traditionalFoods:["travel provisions","portable meals","journey sustenance"],spiritualFocus:["pilgrimage","devotion","sacred travel"],participants:["pilgrims","wandering monks","spiritual seekers"],rarity:"uncommon"}],te=[{technique:"Whisper-Steamed",origin:"Developed by silent monks at the Southern Air Temple for meditation-compatible cooking",traditionalUse:"Used for cleansing ceremonies and purification rituals, especially with lemongrass and mountain herbs",spiritualSignificance:"Represents the gentle approach to life - achieving goals through minimal force and maximum awareness",legendaryPractitioners:["Monk Gyatso","Sister Iio","Master Jinora"],seasonalConnections:["spring cleansing","dawn meditation","new moon ceremonies"],ingredientSynergies:["lemongrass + mountain spring water = cleansing ceremony","tea leaves + wild honey = meditation enhancement"]},{technique:"Steam-Whipped",origin:"Invented at the Northern Air Temple by innovative airbenders seeking efficient preparation methods",traditionalUse:"Essential for creating the light, airy textures favored in sky bison feeding rituals",spiritualSignificance:"Embodies the transformation of simple ingredients through the power of controlled breath and movement",legendaryPractitioners:["Master Mechanist","Guru Laghima","Avatar Yangchen"],seasonalConnections:["windy season preparation","storm cooking","high-altitude meals"],ingredientSynergies:["tofu + air currents = sky-like lightness","mushrooms + steam = cloud texture"]},{technique:"Cloud-Braised",origin:"Ancient technique passed down from the first airbenders who learned from sky bison feeding habits",traditionalUse:"Sacred to the Sky Bison Appreciation Ceremony, used to prepare offerings that honor the bond between species",spiritualSignificance:"Teaches patience and trust in natural processes, allowing ingredients to transform in their own time",legendaryPractitioners:["The Original Airbenders","Sky Bison Herders","Avatar Aang"],seasonalConnections:["monsoon season","cloud formation periods","misty mountain mornings"],ingredientSynergies:["root vegetables + sky bison milk = ancient bond","rice + cloud moisture = perfect absorption"]},{technique:"Wind-Dried",origin:"Created by nomadic airbenders who needed preservation methods during long sky bison journeys",traditionalUse:"Essential for preparing travel provisions and ceremonial offerings that must last through pilgrimages",spiritualSignificance:"Represents the removal of excess and the preservation of essence - a lesson in letting go of the unnecessary",legendaryPractitioners:["Wandering Guru Pathik","Nomadic Masters","Travel Specialists"],seasonalConnections:["dry season preservation","journey preparation","harvest processing"],ingredientSynergies:["fruits + mountain air = concentrated sweetness","herbs + wind currents = preserved healing power"]},{technique:"Levitation-Cooked",origin:"Developed by master airbenders as the ultimate expression of airbending artistry in cuisine",traditionalUse:"Reserved for the most sacred ceremonies and Avatar visitations, demonstrating mastery over the elements",spiritualSignificance:"Symbolizes transcendence of earthly limitations and the elevation of the mundane to the divine",legendaryPractitioners:["Avatar Yangchen","Guru Laghima","Legendary Air Masters"],seasonalConnections:["spiritual celebrations","mastery demonstrations","cosmic events"],ingredientSynergies:["sacred ingredients + spiritual energy = transcendent meals","rare herbs + levitation = enhanced potency"]},{technique:"Meditation-Infused",origin:"Taught by Guru Pathik as a method to combine spiritual practice with daily sustenance preparation",traditionalUse:"Used exclusively during spiritual retreats and when preparing meals for enlightened masters",spiritualSignificance:"Infuses food with spiritual intention and meditative energy, creating nourishment for both body and soul",legendaryPractitioners:["Guru Pathik","Enlightened Hermits","Spiritual Gurus"],seasonalConnections:["meditation seasons","spiritual retreats","contemplative periods"],ingredientSynergies:["tea + meditation = enlightenment aid","simple ingredients + deep focus = profound nourishment"]},{technique:"Sky-Roasted",origin:"Developed by airbenders living at extreme altitudes who learned to harness thin air and intense sunlight",traditionalUse:"Traditional for high-altitude festivals and ceremonies celebrating the sky and open air",spiritualSignificance:"Represents the airbender philosophy of finding opportunity in challenging conditions",legendaryPractitioners:["High-Altitude Masters","Mountain Hermits","Sky Temple Residents"],seasonalConnections:["clear sky days","mountain ceremonies","altitude celebrations"],ingredientSynergies:["root vegetables + high altitude = concentrated flavors","grains + sky roasting = enhanced nutrition"]}],ne=[{ingredients:["Lemongrass","Mountain Spring Water"],technique:"Whisper-Steamed",context:"Temple Cleansing Ceremony",loreHook:"This sacred combination has been used for over a thousand years in Eastern Air Temple purification rituals, where the gentle steam carries prayers to the wind spirits",spiritualMeaning:"Represents purification of both body and spirit, washing away negative energy like morning mist",rarity:"common"},{ingredients:["Tea Leaves","Wild Honey","Meditation"],technique:"Meditation-Infused",context:"Guru's Festival of Repose",loreHook:"Guru Pathik himself perfected this blend during his centuries of hermitage, claiming it opens the crown chakra and facilitates communion with cosmic energy",spiritualMeaning:"The sweetness of enlightenment combined with the clarity of focused mind creates perfect spiritual nourishment",rarity:"rare"},{ingredients:["Mushrooms","Sky Bison Milk"],technique:"Cloud-Braised",context:"Sky Bison Appreciation Ceremony",loreHook:"This ancient pairing honors the first bond between airbenders and sky bison, recreating the forest floor meals that brought the species together ten thousand years ago",spiritualMeaning:"Symbolizes the sacred partnership between human and animal, earth and sky, demonstrating that all life is interconnected",rarity:"uncommon"},{ingredients:["Tofu","Air Currents"],technique:"Steam-Whipped",context:"Day of Ascending Celebration",loreHook:"Young airbenders traditionally prepare this dish for their first solo flight ceremony, with the texture representing the lightness they must achieve in both body and spirit",spiritualMeaning:"The transformation of dense ingredients into airy perfection mirrors the airbender's journey from earthbound student to free-flying master",rarity:"common"},{ingredients:["Sacred Lotus Root","Spirit World Essence"],technique:"Levitation-Cooked",context:"Harmonic Convergence Feast",loreHook:"Only prepared during the rarest of cosmic events when the barrier between worlds grows thin, allowing spirit world ingredients to be harvested by enlightened masters",spiritualMeaning:"Represents the ultimate unity between physical and spiritual realms, nourishing both mortal form and eternal spirit",rarity:"legendary"},{ingredients:["Fruits","Mountain Air"],technique:"Wind-Dried",context:"Wind Walker's Pilgrimage",loreHook:"Pilgrims carry these concentrated spiritual provisions on their sacred journeys, with each bite containing the essence of the mountain winds that dried them",spiritualMeaning:"The preservation process removes the temporary to reveal the eternal, teaching pilgrims to focus on lasting spiritual truths",rarity:"uncommon"}],ie=[{ingredient:"Sacred Lotus Root",rarity:"sacred",origin:"Grows only in the spirit oasis protected by the Moon and Ocean spirits",loreText:"Legend speaks of lotus roots that bridge the material and spirit worlds, harvested only during the full moon by airbenders who have achieved enlightenment. Each root contains memories of a thousand lifetimes and the wisdom of the ancient spirits.",preparationRequirements:["full moon harvest","enlightened master","spirit world blessing","purification ceremony"],spiritualPowers:["spirit world communication","past life memories","enhanced spiritual sensitivity","bridge between worlds"],culturalRestrictions:["Avatar ceremonies only","harmonic convergence","spiritual emergencies","never for personal gain"]},{ingredient:"Sky Bison Milk",rarity:"legendary",origin:"Freely given by ancient sky bison during bonding ceremonies",loreText:"More than sustenance, sky bison milk represents the ultimate trust between species. Only offered during moments of profound spiritual connection, it carries the sky bison's memories of cloud-dancing and wind-riding across the ages.",preparationRequirements:["willing sky bison","spiritual bond","ceremonial context","mutual respect"],spiritualPowers:["enhanced airbending","sky bison communication","wind current reading","aerial grace"],culturalRestrictions:["never demanded","only during ceremonies","must be freely given","requires spiritual bond"]},{ingredient:"Wind Flower Nectar",rarity:"rare",origin:"Blooms only at the highest peaks during windstorms",loreText:"These ethereal flowers bloom for mere minutes during the fiercest mountain storms, their nectar said to contain the essence of pure wind. Collecting it requires an airbender to literally dance with the tempest.",preparationRequirements:["storm dancing","peak climbing","perfect timing","fearless heart"],spiritualPowers:["storm resistance","enhanced agility","wind mastery","fearlessness"],culturalRestrictions:["coming of age ceremonies","master trials","storm season only","solo collection required"]},{ingredient:"Crystal Cave Minerals",rarity:"rare",origin:"Deep within the crystal catacombs where earthbenders and airbenders first met in peace",loreText:"These crystalline formations grow in the sacred caves where ancient earthbenders and airbenders made their first peace treaty. The minerals are said to contain the harmony of opposing elements.",preparationRequirements:["diplomatic blessing","elemental balance","peaceful intention","inter-nation cooperation"],spiritualPowers:["elemental harmony","diplomatic wisdom","conflict resolution","cultural understanding"],culturalRestrictions:["peace ceremonies","diplomatic events","inter-nation festivals","harmony celebrations"]}],re=[{name:"Guru Pathik",specialty:"Chakra-aligning cuisine and spiritual cleansing foods",signature:"Onion and banana juice for crown chakra opening",wisdom:"Food is energy, and energy is life - choose ingredients that elevate consciousness",nation:"air_nomads"},{name:"Monk Gyatso",specialty:"Joyful cooking that brings lightness to the spirit",signature:"Fruit pies that make sky bison and airbenders equally delighted",wisdom:"Cooking should be an act of love, bringing joy to all who partake",nation:"air_nomads"},{name:"Avatar Yangchen",specialty:"Diplomatic cuisine that bridges cultural differences",signature:"Harmony bowls that represent all four nations in perfect balance",wisdom:"A shared meal can accomplish what a hundred treaties cannot",nation:"air_nomads"},{name:"Sister Iio",specialty:"Gentle healing foods for body and spirit recovery",signature:"Whisper-steamed medicinal broths infused with mountain herbs",wisdom:"True healing nourishes not just the body, but the soul's deepest needs",nation:"air_nomads"},{name:"Master Jinora",specialty:"Modern interpretations of ancient spiritual recipes",signature:"Spirit vine teas that enhance meditation and astral projection",wisdom:"Ancient wisdom finds new expression in each generation's kitchen",nation:"air_nomads"}];class ae{constructor(){h(this,"locations",K);h(this,"festivals",ee);h(this,"techniqueLore",te);h(this,"ingredientSynergies",ne);h(this,"legendaryIngredients",ie);h(this,"spiritualFigures",re)}getLocationLore(e){return I.findLocationLore(this.locations,e)}getFestivalContext(){const e=this.festivals.map(n=>n.name),t=g(e);return this.festivals.find(n=>n.name===t)||this.festivals[0]}getTechniqueLore(e){return I.findTechniqueLore(this.techniqueLore,e)}getIngredientSynergy(e,t){return I.findIngredientSynergy(this.ingredientSynergies,e,t)}getLegendaryIngredientContext(e){return I.findLegendaryIngredientContext(this.legendaryIngredients,e)}}const f=new ae;f.getLocationLore.bind(f);const se=f.getFestivalContext.bind(f),oe=f.getTechniqueLore.bind(f),le=f.getIngredientSynergy.bind(f),D=f.getLegendaryIngredientContext.bind(f),C={visual:{gentle:["soft amber glow","delicate pearl-like sheen","whisper-pale translucency","morning mist ethereality","gentle sunset warmth","cloud-kissed whiteness","serene jade undertones","subtle golden highlights","peaceful cream swirls","tender rose blush"],vibrant:["brilliant saffron radiance","deep emerald richness","striking crimson depth","luminous azure clarity","intense amber fire","vivid sunset layers","bold earthen browns","dramatic shadow play","electric golden sparks","passionate ruby gleams"],mystical:["otherworldly opalescence","spirit-realm shimmer","ancient starlight gleaming","cosmic aurora dancing","sacred flame flickering","eternal moonbeam silver","divine energy radiating","transcendent light weaving","celestial patterns forming","mystical energy pulsing"]},aroma:{gentle:["whisper of mountain wildflowers","soft breath of morning dew","delicate temple incense","subtle wind-carried herbs","tender garden blossom","peaceful cedar warmth","gentle earth after rain","quiet meadow sweetness","soft lavender dreams","mild sunshine fragrance"],rich:["deep forest floor complexity","luxurious spice market warmth","intense roasted grain depth","bold herbal symphony","rich caramelized sweetness","powerful earth-smoke blend","concentrated fruit essence","robust nutty undertones","full-bodied aromatic waves","complex layered bouquet"],spiritual:["sacred temple ceremony","ancient meditation halls","divine offering smoke","blessed ritual herbs","enlightened master's tea","spirit world crossing","cosmic energy essence","transcendent purification","holy mountain air","eternal wisdom fragrance"]},taste:{subtle:["barely perceptible sweetness","ghost of distant spice","whisper-light saltiness","delicate floral notes","gentle warming tingle","soft mineral finish","tender herb caress","mild sunshine warmth","peaceful cooling breeze","quiet comfort embrace"],complex:["symphony of seven spices","dancing sweet-savory balance","evolving flavor journey","layered taste revelation","harmonious contrast play","sophisticated depth layers","intricate spice weaving","masterful seasoning blend","nuanced flavor development","orchestrated taste crescendo"],transcendent:["taste of pure enlightenment","flavor beyond earthly bounds","essence of cosmic harmony","spiritual awakening on tongue","divine nectar concentration","taste of ancient wisdom","eternal bliss manifestation","sacred geometry in flavor","universal truth essence","transcendent soul nourishment"]},texture:{delicate:["cloud-soft tenderness","silk-smooth creaminess","feather-light airiness","velvet gentle caress","gossamer delicacy","butterfly wing lightness","morning mist softness","gentle breeze texture","whisper-smooth finish","tender embrace feeling"],substantial:["satisfying earthen density","robust hearty chewiness","substantial grain backbone","rich creamy abundance","solid comforting weight","thick luxurious coating","full-bodied presence","deeply nourishing heft","grounding stability","fulfilling substance"],mystical:["texture that shifts and flows","essence of liquid starlight","material that transcends form","divine substance manifestation","energy-matter transformation","spirit-realm consistency","ethereal density paradox","sacred geometry texture","cosmic fabric weaving","transcendent matter state"]},sound:{gentle:["soft whispered sizzle","quiet bubble meditation","peaceful steam exhale","tender crackling warmth","gentle wind-chime tinkle","soft rain patter","quiet temple bell echo","peaceful breath rhythm","gentle leaf rustle","soft water flow"],dynamic:["enthusiastic bubble symphony","lively crackling celebration","energetic sizzle dance","bold steam percussion","vibrant pop-snap rhythm","spirited bubble chorus","dynamic heat expression","lively cooking orchestra","energetic preparation song","vibrant kitchen symphony"],sacred:["sacred cooking ceremony","divine preparation ritual","holy steam ascending","blessed sizzle prayer","cosmic energy vibration","spiritual transformation sound","sacred flame whisper","divine harmony resonance","transcendent cooking meditation","eternal wisdom bubbling"]}},A={belonging:["Invites a quiet sense of belonging","Creates the warm feeling of coming home","Instills a peaceful sense of acceptance","Awakens the comfort of ancient kinship","Nurtures the soul's need for connection","Embraces the eater with familial warmth","Brings the safety of temple sanctuary","Offers the peace of unconditional welcome","Provides the comfort of spiritual family","Generates the warmth of eternal belonging"],memory:["Reminds the eater of tranquil temple gardens","Evokes memories of peaceful childhood mornings","Calls forth visions of serene mountain retreats","Awakens recollections of sacred ceremonies","Brings back the feeling of gentle guidance","Recalls moments of perfect spiritual clarity","Conjures images of wise teacher's kindness","Evokes the sensation of first flight freedom","Reminds of times when all felt possible","Awakens memories of profound inner peace"],mood:["Cultivates a meditative state of mind","Inspires gentle contemplative reflection","Encourages peaceful inward journeying","Promotes serene mental clarity","Facilitates deep spiritual connection","Generates harmonious emotional balance","Nurtures compassionate understanding","Awakens joyful spiritual appreciation","Creates space for mindful presence","Inspires grateful heart opening"],spiritual:["Connects the spirit to wind and sky","Aligns the soul with cosmic harmony","Opens pathways to deeper wisdom","Facilitates communion with ancient teachings","Harmonizes personal energy with universal flow","Creates resonance with spiritual traditions","Awakens dormant spiritual sensitivities","Bridges the gap between earthly and divine","Facilitates deeper meditation practice","Connects consciousness to eternal truths"]},ce=[{phrase:"Said to linger on the soul for lifetimes",rarity:"transcendent",culturalContext:"universal spiritual truth"},{phrase:"Whispered to echo in the spirit realm",rarity:"sacred",culturalContext:"mystical bridge between worlds"},{phrase:"Believed to awaken past-life memories",rarity:"legendary",culturalContext:"karmic resonance and soul recognition"},{phrase:"Rumored to grant visions of future lives",rarity:"transcendent",culturalContext:"temporal spiritual perception"},{phrase:"Known to imprint itself upon the eternal soul",rarity:"sacred",culturalContext:"permanent spiritual transformation"},{phrase:"Alleged to be remembered in meditation years later",rarity:"legendary",culturalContext:"deep spiritual impression"},{phrase:"Claimed to visit the eater in dreams",rarity:"sacred",culturalContext:"subconscious spiritual continuation"},{phrase:"Thought to create bonds that transcend death",rarity:"transcendent",culturalContext:"eternal spiritual connection"},{phrase:"Believed to carry the wisdom of ancient masters",rarity:"legendary",culturalContext:"lineage transmission through taste"},{phrase:"Said to unlock cosmic consciousness",rarity:"transcendent",culturalContext:"ultimate spiritual awakening"}],de={gentle:["tenderly coaxed to perfection","lovingly guided through transformation","patiently nurtured to readiness","gently encouraged to reveal its essence","softly whispered into harmony","carefully shepherded through each stage","mindfully attended at every moment","gracefully allowed to unfold naturally","peacefully brought to fulfillment","serenely guided to completion"],masterful:["skillfully orchestrated through precise technique","expertly balanced across multiple elements","masterfully woven into culinary poetry","artfully shaped by generations of wisdom","precisely calibrated for optimal harmony","ingeniously combined using ancient methods","brilliantly executed with spiritual intention","flawlessly synchronized in perfect timing","magnificently crafted through devoted practice","supremely refined through master-level technique"],mystical:["transformed through sacred ritual process","elevated by spiritual energy infusion","blessed through ceremonial preparation","consecrated via ancient spiritual practices","sanctified through mindful meditation","purified by cosmic energy alignment","transfigured through divine inspiration","spiritually enhanced through ritual blessing","transcendentally prepared via sacred methods","mystically refined through enlightened practice"]};function he(r="gentle",e=!0,t="common"){const n=g(C.visual[r]),i=g(C.aroma[r==="mystical"?"spiritual":r==="vibrant"?"rich":"gentle"]),a=g(C.taste[r==="mystical"?"transcendent":r==="vibrant"?"complex":"subtle"]),s=g(C.texture[r==="mystical"?"mystical":r==="vibrant"?"substantial":"delicate"]),o={visual:n,aroma:i,texture:s,taste:a};if(r!=="gentle"||Math.random()<.3){const l=r==="mystical"?"sacred":r==="vibrant"?"dynamic":"gentle";o.sound=g(C.sound[l])}if(e&&(o.emotionalResonance={mood:g(A.mood),memory:g(A.memory),spiritual:g(A.spiritual),belonging:g(A.belonging)}),t==="legendary"&&Math.random()<.15||t==="sacred"&&Math.random()<.35||t==="rare"&&Math.random()<.05){const l=ce.filter(c=>t==="legendary"?c.rarity==="legendary":t==="sacred"?c.rarity==="sacred"||c.rarity==="transcendent":!0);if(l.length>0){const c=g(l.map(d=>d.phrase));o.memoryEcho=c}}return o}function ge(r,e="gentle"){const t=g(de[e]);return`The ingredients are ${r.toLowerCase().includes("steam")?"steamed":r.toLowerCase().includes("whip")?"whipped":r.toLowerCase().includes("roast")?"roasted":r.toLowerCase().includes("dry")?"dried":r.toLowerCase().includes("braise")?"braised":r.toLowerCase().includes("levitation")?"elevated":r.toLowerCase().includes("meditation")?"infused":"prepared"} ${t}`}function ue(r,e,t){return t||r?"mystical":e==="masterful"||e==="complex"?"vibrant":"gentle"}var k=(r=>(r[r.TRADITIONAL=0]="TRADITIONAL",r[r.FESTIVAL_FIRST=1]="FESTIVAL_FIRST",r[r.MYTH_LED=2]="MYTH_LED",r[r.INGREDIENT_FOCUSED=3]="INGREDIENT_FOCUSED",r))(k||{});class me{constructor(){h(this,"dishCounter",0)}selectTemplate(e,t,n){this.dishCounter++;const i=e.map(v=>v.name),a=this.findLegendaryIngredient(i),s=oe(t.name),o=le(i,t.name),l=se(),c=!!a,d=e.some(v=>v.isSacred),y=t.timeRequired==="ceremonial"?"masterful":t.timeRequired==="slow"?"complex":t.timeRequired==="moderate"?"moderate":"simple",m=ue(c,y,c||d||!!s),p=Math.max(...e.map(v=>v.rarity==="legendary"?4:v.rarity==="rare"?3:v.rarity==="uncommon"?2:1)),B=he(m,!0,p===4?"legendary":p===3?"rare":p===2?"uncommon":"common"),U=m==="vibrant"?"masterful":m,O=ge(t.name,U),x={ingredients:e,technique:t,legendaryContext:a,techniqueLore:s,ingredientSynergy:o,festivalContext:l,sensoryProfile:B,preparationNarrative:O},H=p>=3;return c||H?{templateType:2,templateData:x}:{templateType:Math.floor(Math.random()*4),templateData:x}}findLegendaryIngredient(e){for(const t of e){const n=D(t);if(n)return n}return null}shouldApplyWildcard(){return this.dishCounter%3===0||this.dishCounter%5===0}getDishCounter(){return this.dishCounter}reset(){this.dishCounter=0}}class u{static composeTraditionalTemplate(e,t){const n=u.generateOpeningHooks(e,t),i=u.generateSensoryIntegration(e,t),a=u.generateEmotionalResonance(e,t),s=u.generateServingContext(e,t);return u.weaveProseElements(n,i,a,s,t)}static composeFestivalFirstTemplate(e,t){const n=e.ingredients.map(l=>l.name),i=u.generateServingContext(e,t),a=`${n[0]} and ${n.slice(1,3).join(", ")} are ${e.technique.name.toLowerCase()} with reverent precision`,s=u.generateSensoryIntegration(e,t),o=u.generateEmotionalResonance(e,t);return`${i}. Here, ${a}, creating ${s}. ${o}.`}static composeMythLedTemplate(e,t){var c;const n=e.ingredients.map(d=>d.name);if(e.legendaryContext||e.ingredients.some(d=>d.rarity==="legendary"||d.rarity==="rare"))return u.composeLegendaryParagraph(e,t);const i=[`Ancient scrolls speak of a time when ${n[0]} held the power to bridge worlds`,`Legend has it that Avatar Yangchen first discovered the harmony between ${n[0]} and ${n[1]}`,`The traveling monks whisper of ${e.technique.name.toLowerCase()} techniques that transform simple ingredients into spiritual sustenance`,`In the highest meditation chambers, masters debate whether ${n[0]} chooses its moment or is chosen by fate`],a=t.selectUniqueFragment(i),s=`Through the ${e.technique.name.toLowerCase()} method, these ingredients ${e.sensoryProfile.texture&&e.sensoryProfile.texture.includes("transcend")?"transcend their earthly form":"achieve perfect harmony"}`,o=`revealing ${e.sensoryProfile.taste} that ${((c=e.sensoryProfile.emotionalResonance)==null?void 0:c.spiritual)||"awakens the soul to deeper truths"}`,l=u.generateServingContext(e,t);return`${a}. ${s}, ${o}. ${l}.`}static composeIngredientFocusedTemplate(e,t){const n=e.ingredients.map(c=>c.name),a=`From the sacred groves where ${n[0]} grows in harmony with ${n.slice(1,3).join(" and ")}, temple cooks gather only the finest specimens`,s=`Each ingredient carries the blessing of mountain winds and temple prayers, chosen for their ability to ${e.technique.name.toLowerCase()==="steam-whipped"?"achieve weightless perfection":"harmonize with ancient cooking wisdom"}`,o=`The ${e.technique.name.toLowerCase()} technique draws forth ${e.sensoryProfile.taste}, creating ${e.sensoryProfile.texture}`,l=u.generateEmotionalResonance(e,t);return`${a}. ${s}, and through careful preparation, the ${o}. ${l}.`}static composeLegendaryParagraph(e,t){var m;const n=e.ingredients.map(p=>p.name),i=n[0],a=((m=e.legendaryContext)==null?void 0:m.ingredient)||n[1],s=[`In the shadow of forgotten temples, ancient monks gathered ${i} and ${a}, seeking wisdom woven into the wind.`,`Beyond the reach of mortal kitchens, where ${i} and ${a} grow in sacred groves, the masters discovered flavors that echo across lifetimes.`,`From the highest peaks where wind-riders soar, ${i} and ${a} are gathered only when the stars align with temple spires.`,`In meditation halls carved from living rock, ${i} and ${a} were first blessed by Avatar Yangchen herself.`],o=e.legendaryContext?[`It is said that only once each century does ${e.legendaryContext.ingredient} reveal its full power, releasing ${e.sensoryProfile.visual} as the aroma stirs memory from past lives.`,`Legend speaks of ${e.legendaryContext.ingredient} that appears only to those pure of heart, its ${e.sensoryProfile.visual} marking the presence of ancient spirits.`,`The mystical ${e.legendaryContext.ingredient} has been sought by sages for generations, its power awakening when blessed by mountain winds and starlight.`,`Master Tenzin taught that ${e.legendaryContext.ingredient} chooses its moment, revealing ${e.sensoryProfile.visual} that bridges the mortal and spirit worlds.`]:[`Through mists that rise from sacred peaks, ${i} transforms beneath the ${e.technique.name.toLowerCase()} technique, each moment a prayer whispered to eternity.`,`As temple bells ring across the valleys, ${i} undergoes ${e.technique.name.toLowerCase()}, its essence awakening like incense smoke.`,`In the quiet hours before dawn, ${i} is transformed through ${e.technique.name.toLowerCase()}, each step a meditation in itself.`,`With reverent hands, temple cooks apply the ${e.technique.name.toLowerCase()} technique to ${i}, honoring traditions older than memory.`],l=["Each bite is a silent prayer, every flavor a ripple across time.","Every taste becomes a meditation, each morsel carrying sacred intention.","Each portion holds divine reverence, every sensation touching the infinite.","Every flavor whispers ancient blessings, each taste echoing through eternity."],c=[`${e.sensoryProfile.taste} unfolds like ancient scrolls, while ${e.sensoryProfile.texture} grounds the soul in forgotten truths.`,`${e.sensoryProfile.taste} emerges like temple incense, while ${e.sensoryProfile.texture} connects the heart to timeless knowledge.`,`${e.sensoryProfile.taste} develops like distant thunder, while ${e.sensoryProfile.texture} awakens memories of sacred teachings.`,`${e.sensoryProfile.taste} blooms like mountain flowers, while ${e.sensoryProfile.texture} anchors the spirit in ancient wisdom.`],d=t.selectUniqueFestival(),y=[`Legends insist this dish is prepared only during the ${d}, as starlight falls through clouded peaks and the veil between worlds grows thin.`,`Created solely during the ${d}, when reality seems to shimmer and bend beneath celestial influence.`,`Reserved for the sacred ${d}, as the boundary between sacred and mundane dissolves into eternity.`,`Made only in honor of the ${d}, when temporal boundaries blur and the material world fades into spirit.`,"No one leaves unchanged. The temple bells echo, and somewhere in the distance, sky bison call to their ancient kin.","Those who taste this dish carry its essence forever, their spirits marked by the touch of something eternal.","The memory lingers long after the meal ends, a gentle reminder of truths that transcend the material world.","In sharing this sacred food, bonds form that stretch across lifetimes, uniting all who seek the path of enlightenment."],w=[t.selectUniqueFragment(s),t.selectUniqueFragment(o),t.selectUniqueFragment(l)+" "+t.selectUniqueFragment(c),t.selectUniqueFragment(y)];if(e.sensoryProfile.sound){const p=[`The kitchen fills with ${e.sensoryProfile.sound}, a sound that monks say carries the voices of all who came before.`,`The cooking space resonates with ${e.sensoryProfile.sound}, echoes of ancient wisdom reverberating through temple halls.`,`The sacred space hums with ${e.sensoryProfile.sound}, whispers of ancestral knowledge flowing like mountain streams.`,`The preparation area vibrates with ${e.sensoryProfile.sound}, a gentle reminder of the countless meals prepared in devotion.`];w.splice(2,0,t.selectUniqueFragment(p))}return w.filter(Boolean).join(" ")}static generateOpeningHooks(e,t){const n=e.ingredients.map(l=>l.name),i=n[0],a=Math.random()<.33;let s="";if(a){const l=["Legend has it that Avatar Yangchen first prepared this dish during a diplomatic summit between the four nations. ","Monk Gyatso once broke a month-long meditation silence with a single spoonful of this sacred preparation. ","Ancient texts speak of sky bison gathering whenever this dish is prepared in the high temples. ","Master Tenzin taught that this recipe carries the wisdom of a thousand generations of Air Nomads. ","The traveling monks of the Eastern Temple would prepare this dish only under the full moon. "];s=t.selectUniqueFragment(l)}if(e.legendaryContext){const l=[`${s}In the deepest caverns of the Crystal Catacombs, where ${e.legendaryContext.ingredient} forms over centuries, the ancient monks discovered ingredients that shimmer with ${e.sensoryProfile.visual}. This transcendent creation`,`${s}When ${e.legendaryContext.ingredient} is blessed by starlight and mountain winds, it transforms ordinary cooking into something sacred. ${i} and ${n.slice(1,3).join(", ")}, ${e.technique.name.toLowerCase()} with reverent precision,`,`${s}The mystical ${e.legendaryContext.ingredient} has been sought by Air Nomad masters for generations. Combined with ${n.slice(0,2).join(" and ")}, then ${e.technique.name.toLowerCase()} until ${e.sensoryProfile.visual} dances through the mixture,`];return t.selectUniqueFragment(l)}if(e.techniqueLore){const l=e.techniqueLore.traditionalUse.toLowerCase().replace(/^used for\s*/i,"").replace(/^traditionally\s*/i,""),c=[`${s}Master ${t.selectUniqueFragment(e.techniqueLore.legendaryPractitioners)} perfected the art of ${e.technique.name.toLowerCase()}, teaching that ${i} and ${n.slice(1,2).join(", ")} must be prepared with the patience of mountain stones. Through this ancient method, ingredients ${l}, while`,`${s}The ${e.technique.name} technique, passed down through generations of Air Nomad cooks, transforms simple ${n.slice(0,2).join(" and ")} into something profound. As steam rises and ${e.sensoryProfile.aroma} fills the temple kitchen,`,`${s}Following the wisdom of ${t.selectUniqueFragment(e.techniqueLore.legendaryPractitioners)}, this preparation honors the ancient ${e.technique.name} method. ${i}, ${n.slice(1,3).join(", ")}, each ingredient ${l} as they`];return t.selectUniqueFragment(c)}const o=[`${s}In the high temples where wind carries prayers across mountain peaks, ${i} is ${e.technique.name.toLowerCase()} with ${n.slice(1,2).join(" and ")}, creating`,`${s}When temple bells ring across the valleys, Air Nomad cooks gather ${n.slice(0,3).join(", ")} for this time-honored preparation. The ${e.technique.name.toLowerCase()} process fills the kitchen with ${e.sensoryProfile.aroma}, as`,`${s}Beneath prayer flags fluttering in mountain winds, this dish brings together ${n.slice(0,2).join(" and ")} through the gentle art of ${e.technique.name.toLowerCase()}. Each ingredient`,`${s}From the floating gardens of the Western Air Temple comes this harmonious blend of ${i} and ${n.slice(1,2).join(", ")}, ${e.technique.name.toLowerCase()} until ${e.sensoryProfile.visual} weaves through the mixture, and`];return t.selectUniqueFragment(o)}static generateSensoryIntegration(e,t){const n=[`the ${e.sensoryProfile.taste} unfolds like morning mist over temple gardens, while ${e.sensoryProfile.texture} provides the grounding comfort that only sacred food can offer`,`flavors dance between ${e.sensoryProfile.taste} and something deeper—a ${e.sensoryProfile.texture} that seems to carry the essence of mountain air itself`,`each spoonful reveals ${e.sensoryProfile.taste} layered with the wisdom of generations, its ${e.sensoryProfile.texture} reminiscent of clouds gathering before dawn`,`the dish awakens with ${e.sensoryProfile.taste} that speaks of ancient recipes, while its ${e.sensoryProfile.texture} mirrors the gentle strength of Air Nomad philosophy`];let i=t.selectUniqueFragment(n);if(e.sensoryProfile.sound){const a=[`. During preparation, the kitchen fills with ${e.sensoryProfile.sound}, a meditation in itself`,`. The ${e.sensoryProfile.sound} during cooking becomes part of the temple's daily rhythm`,`, accompanied by the gentle ${e.sensoryProfile.sound} that draws monks from their studies`];i+=t.selectUniqueFragment(a)}return i}static generateEmotionalResonance(e,t){if(!e.sensoryProfile.emotionalResonance)return"";const n=[e.sensoryProfile.emotionalResonance.mood,e.sensoryProfile.emotionalResonance.belonging,e.sensoryProfile.emotionalResonance.memory,e.sensoryProfile.emotionalResonance.spiritual].filter(Boolean);if(n.length===0)return"";const i=[`This sacred meal ${n[0]}, ${n[1]?`and in doing so, ${n[1]}`:""}`,`Each bite ${n[0]}, creating moments where ${n[1]||"peace settles over the soul"}`,`The dish ${n[0]} while ${n[1]||"connecting diners to something eternal"}`,`Beyond nourishment, this preparation ${n[0]}, ${n[1]?`gently ${n[1]}`:""}`,`Those who share this meal find that it ${n[0]}, and through this simple act, ${n[1]||"discover the interconnectedness of all things"}`];let a=t.selectUniqueFragment(i);if(e.sensoryProfile.memoryEcho){const s=[`. ${e.sensoryProfile.memoryEcho}`,`, ${e.sensoryProfile.memoryEcho.toLowerCase()}`,`. Many say ${e.sensoryProfile.memoryEcho.toLowerCase()}`];a+=t.selectUniqueFragment(s)}return a}static generateServingContext(e,t){var i;const n=["Shared in the circular halls of the Eastern Air Temple, where floating prayer wheels cast shifting shadows","Served during the golden hour when sky bison return to their roosts and temple bells echo across valleys","Offered in the Western Temple's gravity-defying dining chambers, where monks gather in grateful silence","Prepared for travelers seeking shelter in mountain monasteries, a gesture of Air Nomad hospitality","Traditional during meditation retreats, when the community gathers to break contemplative silence","Served at dawn ceremonies when the temple awakens with chanted prayers and incense smoke"];if((i=e.festivalContext)!=null&&i.name||Math.random()<.7){const a=t.selectUniqueFestival(),s=[`Central to the ${a} celebration, when all four temples unite in joyous ceremony`,`A cornerstone of ${a} festivities, prepared by master cooks for hundreds of pilgrims`,`Essential to ${a} traditions, this dish celebrates the cycle of renewal`,`Fundamental to ${a} observances, honoring the passage of celestial time`,`Sacred to the ${a} ceremony, acknowledging the rhythm of temple life`,`Central to ${a} rituals, embracing the flow of natural change`,`Treasured during the ${a}, when ancient wisdom flows like mountain streams`,`Revered in the ${a} gathering, where spirits and mortals commune in peace`];return t.selectUniqueFragment(s)}return t.selectUniqueFragment(n)}static weaveProseElements(e,t,n,i,a){const s=[`${e} ${t}. ${n}. ${i}.`,`${e} ${t}, and ${n.toLowerCase()}. ${i}.`,`${e} ${t}. ${i}, where ${n.toLowerCase()}.`,`${e} ${n.toLowerCase()}, through ${t}. ${i}.`,`${e} ${t}. ${n} ${i.toLowerCase()}.`];return a.selectUniqueFragment(s)}}class pe{constructor(){h(this,"fragmentCache");h(this,"templateSelector");this.fragmentCache=new Q,this.templateSelector=new me}composeDishDescription(e,t){try{const{templateType:n,templateData:i}=this.templateSelector.selectTemplate(e,t,this.fragmentCache);let a=this.generateProseByTemplate(n,i);return this.templateSelector.shouldApplyWildcard()&&(a=this.fragmentCache.insertWildcardEvent(a)),a}catch(n){throw new Error(`ProseComposer.composeDishDescription: Failed to compose description - ${n instanceof Error?n.message:"Unknown error"}`)}}generateProseByTemplate(e,t){switch(e){case k.TRADITIONAL:return u.composeTraditionalTemplate(t,this.fragmentCache);case k.FESTIVAL_FIRST:return u.composeFestivalFirstTemplate(t,this.fragmentCache);case k.MYTH_LED:return u.composeMythLedTemplate(t,this.fragmentCache);case k.INGREDIENT_FOCUSED:return u.composeIngredientFocusedTemplate(t,this.fragmentCache);default:return u.composeTraditionalTemplate(t,this.fragmentCache)}}reset(){this.fragmentCache.reset(),this.templateSelector.reset()}softReset(){this.fragmentCache.softReset()}getDishCounter(){return this.templateSelector.getDishCounter()}}const fe=new pe;function ye(r,e){return fe.composeDishDescription(r,e)}function we(r,e){const t=r.map(o=>o.name),n=be(t),i=ve(r,n),a=t[0],s=t.length>1?t[1]:null;return n?Se(i,a,e,n):$e(i,a,s,e)}function be(r){for(const e of r){const t=D(e);if(t)return t}return null}function ve(r,e){const t=!!e,n=r.some(s=>s.isSacred),i=Math.max(...r.map(s=>s.rarity==="legendary"?4:s.rarity==="rare"?3:s.rarity==="uncommon"?2:1));return t?g(["Avatar's","Ancient Master's","Sky Father's","Temple Guardian's","Eternal Monk's","Sacred Elder's","Celestial Master's"]):n||i>=3?g(["Temple Elder's","Master's","Guru's","High Monk's","Sacred","Blessed","Enlightened"]):i>=2?g(["Cloud Dancer's","Wind Walker's","Mountain Sage's","Temple Cook's","Traveling Monk's","Sky Nomad's","Meditation Master's"]):g(["Novice's","Student's","Young Monk's","Temple","Simple","Humble","Daily","Community"])}function Se(r,e,t,n){const i=_(t),a=[`${r} ${n.ingredient} ${i}`,`${r} Transcendent ${i} ${e}`,`${r} Sacred ${n.ingredient} Preparation`,`${r} Celestial ${i} with ${n.ingredient}`];return g(a)}function $e(r,e,t,n){const i=_(n),a=[`${r} ${i} ${e}`,`${r} ${e} ${i}`,...t?[`${r} ${i} ${e} and ${t}`,`${r} ${e} with ${t}`,`${r} Balanced ${i} ${e}`]:[],`${r} ${i} Creation`,`${r} ${Ce(n)} ${e}`];return g(a)}function _(r){const t={"Steam-Whipping":["Steam-Whipped","Cloud-Whipped","Mist-Whipped"],"Whisper-Steaming":["Whisper-Steamed","Gentle-Steamed","Breath-Steamed"],"Wind-Drying":["Wind-Dried","Air-Dried","Breeze-Dried"],"Float-Boiling":["Float-Boiled","Levitating","Floating"],"Meditation Brewing":["Meditation-Brewed","Contemplative","Mindful"],"Sky-Roasting":["Sky-Roasted","Cloud-Roasted","Wind-Roasted"]}[r.name]||[r.name];return g(t)}function Ce(r){const t={"Steam-Whipping":["Ethereal","Floating","Elevated"],"Whisper-Steaming":["Gentle","Soft","Pure"],"Wind-Drying":["Preserved","Concentrated","Essential"],"Float-Boiling":["Levitated","Suspended","Weightless"],"Meditation Brewing":["Contemplative","Peaceful","Centered"],"Sky-Roasting":["Elevated","Ascending","Lifted"]}[r.name]||["Sacred"];return g(t)}let $=new Set;function E(r){const e=r.filter(n=>!$.has(n));if(e.length===0)return $.clear(),r[Math.floor(Math.random()*r.length)];const t=e[Math.floor(Math.random()*e.length)];if($.add(t),$.size>T.PHRASE_CACHE_SIZE_LIMIT){const n=Array.from($)[0];$.delete(n)}return t}function ke(r){let e=r;for(const[t,n]of Object.entries(V))if(e.includes(t)){const i=E(n);e=e.replace(t,i)}return e}function W(r){let e=r;e=ke(e),e=Ie(e);for(let t=0;t<3;t++)e=Ae(e);return e.trim()}function Ie(r){return r.replace(/for the sacred the ([A-Za-z ]+ Festival)/g,"for the sacred $1").replace(/for the sacred the (Monk's [A-Za-z ]+)/g,"for the sacred $1").replace(/during the sacred the ([A-Za-z ]+)/g,"during the sacred $1").replace(/in the ancient the ([A-Za-z ]+)/g,"in the ancient $1").replace(/gentle the sacred/g,"gentle sacred").replace(/soft the sacred/g,"soft sacred").replace(/quiet the sacred/g,"quiet sacred").replace(/divine the preparation/g,"divine preparation").replace(/flavors dance between flavors/g,"flavors dance between transcendence").replace(/tastes blend with tastes/g,"tastes blend with essence").replace(/aromas mix with aromas/g,"aromas mix with fragrances").replace(/essence merges with essence/g,"essence merges with spirit").replace(/([a-z\s]+) a cornerstone of ([^.,]+) festivities, prepared/g,"$1 and becomes a cornerstone of $2 festivities, prepared").replace(/([a-z\s]+) essential to ([^.,]+) traditions, this dish/g,"$1. Essential to $2 traditions, this dish").replace(/([a-z\s]+) central to ([^.,]+) rituals, embracing/g,"$1. Central to $2 rituals, it embraces").replace(/([a-z\s]+) fundamental to ([^.,]+) ceremonies, honoring/g,"$1. Fundamental to $2 ceremonies, it honors").replace(/Crystal Cave Minerals has been/g,"Crystal Cave Minerals have been").replace(/Bamboo Shoots has been/g,"Bamboo Shoots have been").replace(/Lychee Nuts has been/g,"Lychee Nuts have been").replace(/Bell Peppers has been/g,"Bell Peppers have been").replace(/Chrysanthemum Greens has been/g,"Chrysanthemum Greens have been").replace(/creating moments where Brings/g,"creating moments that bring").replace(/while Generates/g,"and generates").replace(/where Brings the safety/g,"that brings the safety").replace(/while Creates/g,"and creates").replace(/while Nurtures/g,"and nurtures").replace(/while Promotes/g,"and promotes").replace(/reveals taste of/g,"reveals the taste of").replace(/shows essence of/g,"shows the essence of").replace(/displays flavor of/g,"displays the flavor of").replace(/carries wisdom of/g,"carries the wisdom of").replace(/fills with divine, a sound/g,"fills with divine sound, a melody").replace(/fills with divine preparation ritual/g,"fills with the sounds of divine preparation").replace(/fills with ([a-z\s]+), a sound that/g,"fills with $1, a melody that").replace(/as they flavors dance/g,"as flavors dance").replace(/Flavors that transcend earthly bounds unfolds/g,"Flavors that transcend earthly bounds unfold").replace(/([Ff]lavors[^.]*) unfolds/g,"$1 unfold").replace(/ancient wisdom([^.]*) ancient wisdom/gi,"ancient wisdom$1 timeless knowledge").replace(/cosmic fabric weaving anchors the spirit in ancient wisdom/g,"cosmic fabric anchors the spirit in ancient wisdom").replace(/\b(\w+) and \1\b/g,"$1").replace(/\b(the) \1\b/g,"$1").replace(/\b(with) \1\b/g,"$1").replace(/\s+,/g,",").replace(/,(?!\s)/g,", ")}function Ae(r){let e=r;return e=Te(e),e=Ee(e),e=Re(e),e=Le(e),e=qe(e),e=Fe(e),e=xe(e),e=Me(e),e}function Te(r){return r.replace(/through used for ([^,\.]+)/gi,"used for $1").replace(/through traditionally ([^,\.]+)/gi,"traditionally $1").replace(/through ([^,\.\s]+) for ([^,\.]+)/gi,"$1 for $2").replace(/as The ingredients/gi,"as the ingredients").replace(/as ([A-Z][a-z]+) are ([a-z]+)/gi,"as $1 is $2").replace(/steamed with ingredients blessed through ceremonial preparation/gi,"steamed with ceremonially blessed ingredients").replace(/through essential for creating/gi,"essential for creating").replace(/With ancient ([^,]+), it remarkable/gi,"With ancient $1, it is remarkable").replace(/displays ([a-z\s]+) forming/gi,"displays $1 that forms").replace(/releases ([a-z\s]+) crossing/gi,"releases aromas of $1").replace(/releases ([a-z\s]+) herbs/gi,"releases the essence of $1 herbs").replace(/displays ([a-z\s]+) radiating/gi,"displays $1 that radiates").replace(/displays ([a-z\s]+) weaving/gi,"displays $1 that weaves").replace(/releases ([a-z\s]+) purification/gi,"releases purifying $1").replace(/releasing sacred flame flickering/gi,"releasing sacred flames that flicker").replace(/Sacred geometry in flavor unfolds/gi,"Sacred geometry unfolds in flavor").replace(/universal truth essence/gi,"the essence of universal truth").replace(/energy-matter transformation/gi,"transformation of energy and matter").replace(/flavor beyond earthly bounds/gi,"flavors that transcend earthly bounds").replace(/divine nectar concentration/gi,"concentrated divine nectar").replace(/transcendent light weaving/gi,"transcendent light that weaves").replace(/essence of ([^,]+), while essence of ([^,\.]+)/gi,"$1, while $2").replace(/Essence of ([^,]+) unfolds[^,]+, while essence of ([^,\.]+)/gi,"$1 unfolds like ancient scrolls, while $2").replace(/essence of cosmic harmony unfolds[^,]+, while essence of liquid starlight/gi,"cosmic harmony unfolds like ancient scrolls, while liquid starlight").replace(/material that transcends form/gi,"the ingredients themselves transcend earthly form").replace(/cosmic fabric weaving provides/gi,"cosmic fabric provides").replace(/divine substance manifestation/gi,"divine essence").replace(/eternal bliss manifestation/gi,"eternal bliss").replace(/the ingredients themselves transcend earthly form grounds the soul/gi,"the ingredients themselves, transcending earthly form, ground the soul").replace(/transcend earthly form grounds/gi,"transcend earthly form, grounding").replace(/([a-z\s]+) transcend earthly form grounds ([a-z\s]+)/gi,"$1, transcending earthly form, ground $2").replace(/preparation while traditionally customarily offered/gi,"preparation traditionally offered").replace(/while traditionally customarily/gi,"traditionally").replace(/customarily traditionally/gi,"traditionally").replace(/spiritual significance cultural/gi,"cultural and spiritual significance").replace(/cultural significance spiritual/gi,"spiritual and cultural significance").replace(/each ingredient cleansing ceremonies/gi,"each ingredient chosen for cleansing ceremonies").replace(/each ingredient purification rituals/gi,"each ingredient selected for purification rituals").replace(/each ingredient spiritual ceremonies/gi,"each ingredient chosen for spiritual ceremonies").replace(/ingredients cleansing ceremonies and purification rituals/gi,"ingredients are prepared for cleansing ceremonies and purification rituals").replace(/Through this ancient method, ingredients cleansing/gi,"Through this ancient method, ingredients are prepared for cleansing").replace(/as they flavors dance/gi,"as flavors dance").replace(/as they ([a-z]+) ([a-z]+)/gi,"as $1 $2").replace(/they flavors/gi,"the flavors").replace(/while awakens ([a-z\s]+)/gi,"and awakens $1").replace(/where the dish ([a-z\s]+) while awakens/gi,"where the dish $1 and awakens").replace(/nurtures ([a-z\s]+) while awakens/gi,"nurtures $1 and awakens").replace(/especially with ([a-z\s]+), ([a-z\s]+) as they/gi,"especially when paired with $1 and $2. As").replace(/especially with ([a-z\s]+), ([a-z\s]+) as/gi,"especially when paired with $1 and $2, as")}function Ee(r){return r.replace(/selected for chosen for selected for chosen for selected for chosen for/gi,"selected for").replace(/chosen for selected for chosen for selected for chosen for/gi,"chosen for").replace(/selected for chosen for selected for chosen for/gi,"selected for").replace(/chosen for selected for chosen for/gi,"chosen for").replace(/selected for chosen for selected for/gi,"selected for").replace(/chosen for selected for/gi,"chosen for").replace(/selected for chosen for/gi,"selected for").replace(/\b(\w+)\s+\1\b/gi,"$1").replace(/\b(the)\s+\1\b/gi,"$1").replace(/\b(and)\s+\1\b/gi,"$1").replace(/\b(with)\s+\1\b/gi,"$1").replace(/\b(through)\s+\1\b/gi,"$1").replace(/\b(while)\s+\1\b/gi,"$1").replace(/\b(enhancing)\s+\1\b/gi,"$1").replace(/\b(embodies)\s+\1\b/gi,"$1").replace(/\b(represents)\s+\1\b/gi,"$1").replace(/embodies represents/gi,"embodies").replace(/represents embodies/gi,"represents").replace(/enhancing improving/gi,"enhancing").replace(/improving enhancing/gi,"improving").replace(/ancient traditional/gi,"ancient").replace(/traditional ancient/gi,"traditional").replace(/profoundish/gi,"profound").replace(/transcendental transcendent/gi,"transcendent").replace(/spiritual spirituality/gi,"spiritual").replace(/meditative meditation/gi,"meditative")}function Re(r){return r.replace(/\ba essence\b/gi,"an essence").replace(/\ba aroma\b/gi,"an aroma").replace(/\ba ancient\b/gi,"an ancient").replace(/\ba elevated\b/gi,"an elevated").replace(/\ba ethereal\b/gi,"an ethereal").replace(/\ba inner\b/gi,"an inner").replace(/\ba understanding\b/gi,"an understanding").replace(/ingredients are steamed/gi,"ingredients are steamed").replace(/ingredient are/gi,"ingredient is").replace(/techniques are used/gi,"techniques are used").replace(/technique are/gi,"technique is")}function Le(r){return r.replace(/displayspirit-realm/gi,"displays spirit-realm").replace(/starlighthat/gi,"starlight that").replace(/windthat/gi,"wind that").replace(/templekitchen/gi,"temple kitchen").replace(/mountainpeaks/gi,"mountain peaks").replace(/prayerwheels/gi,"prayer wheels").replace(/spirit - realm/gi,"spirit-realm").replace(/mountain - top/gi,"mountain-top").replace(/temple - bells/gi,"temple bells").replace(/prayer - flags/gi,"prayer flags").replace(/([a-z])([A-Z])/g,"$1 $2")}function Fe(r){return r.replace(/([a-z]) ([A-Z][a-z\s]+), ([A-Z][a-z\s]+), ([A-Z][a-z\s]+), each/gi,"$1. $2, $3, and $4—each").replace(/([a-z]) ([A-Z][a-z\s]+) and ([A-Z][a-z\s]+)—each/gi,"$1. $2 and $3—each").replace(/([a-z\s]+), especially ([a-z\s]+), ([a-z\s]+) as ([a-z])/gi,"$1, especially when $2. $3 as $4").replace(/([a-z\s]+), especially with ([a-z\s]+) as ([a-z])/gi,"$1, especially when paired with $2. As $3").replace(/fills the temple kitchen, the ([A-Z][a-z\s]+) unfolds/gi,"fills the temple kitchen. $1 unfolds").replace(/cosmic energy essence fills ([^,]+), the ([A-Z][a-z\s]+)/gi,"cosmic energy essence fills $1. The $2").replace(/([a-z\s]+), and ([a-z\s]+), and in doing so, ([A-Z][a-z\s]+)/gi,"$1 and $2. In doing so, it $3").replace(/Flavors that transcend earthly bounds unfolds/gi,"Flavors that transcend earthly bounds unfold").replace(/([A-Z][a-z\s]+) unfolds like ancient scrolls, while ([a-z\s]+) grounds/gi,"$1 unfold like ancient scrolls, while $2 ground").replace(/ethereal density paradox grounds/gi,"ethereal density paradox that grounds").replace(/accompanied by the gentle ([a-z\s]+) that draws/gi,"accompanied by the gentle $1 that draws").replace(/the kitchen fills with the ([a-z\s]+) that draws/gi,"the kitchen fills with the $1 that draws").replace(/air itself, accompanied by/gi,"air itself. The preparation is accompanied by").replace(/studies\. Essential to/gi,"studies. Essential to").replace(/seasons, where the dish/gi,"seasons. This dish").replace(/As ([^,]+), while ([^,]+) provides/gi,"As $1, the $2 provides").replace(/as ([^,]+), while ([^,]+)/gi,"as $1, the $2").replace(/while transformation of energy and matter/gi,"as the transformation of energy and matter").replace(/spiritual transformation sound/gi,"gentle hum of transformation").replace(/divine harmony resonance/gi,"divine resonance").replace(/fills with ([a-z\s]+) sound/gi,"fills with the soft $1").replace(/fills with ([a-z\s]+) resonance, a sound/gi,"fills with $1, a sound").replace(/blessed sizzle prayer/gi,"blessed sizzle of prayer").replace(/sacred cooking ceremony/gi,"the sacred sounds of cooking").replace(/cosmic energy vibration/gi,"the gentle vibration of cosmic energy").replace(/connection central to the/gi,"connection. It is central to the").replace(/presence, gently ([A-Z][a-z]+) the/gi,"presence, gently $1 the").replace(/a meditation in itself/gi,E(["a meditation in itself","its own form of prayer","a sacred ritual unto itself"])).replace(/gentle hum of transformation/gi,E(["gentle hum of transformation","soft whisper of change","quiet song of spiritual alchemy"])).replace(/the voices of all who came before/gi,E(["the voices of all who came before","echoes of ancient wisdom","whispers of ancestral knowledge"])).replace(/nurtures ([a-z\s]+) while awakens/gi,"nurtures $1 and awakens").replace(/marks ([a-z\s]+), where ([a-z\s]+) while ([a-z])/gi,"marks $1. It $2 and $3")}function qe(r){return r.replace(/preparation ([A-Z][a-z]+) space/gi,"preparation $1 space").replace(/preparation Creates/gi,"preparation creates").replace(/gently Nurtures/gi,"gently nurtures").replace(/([a-z]), ([A-Z][a-z]+) ([a-z])/g,"$1, $2 $3").replace(/\.\s+([a-z])/g,(e,t)=>". "+t.toUpperCase()).replace(/\.\./g,".").replace(/,,/g,",").replace(/;;/g,";").replace(/([A-Z][a-z]+)\. ([A-Z][a-z]+)/g,"$1 $2").replace(/([a-z]),([A-Z])/g,"$1, $2").replace(/\s+,/g,",").replace(/,(?!\s)/g,", ").replace(/\s+\./g,".").replace(/\.(?!\s|$)/g,". ").replace(/"\s+/g,'"').replace(/\s+"/g,'"').replace(/([a-z])\s*$/gi,"$1.")}function xe(r){return r.replace(/enhancing ([^,]+) and enhancing ([^,]+) and enhancing ([^,\.]+)/gi,"enhancing $1, $2, and $3").replace(/improving ([^,]+) and improving ([^,]+) and improving ([^,\.]+)/gi,"improving $1, $2, and $3").replace(/promoting ([^,]+) and promoting ([^,]+) and promoting ([^,\.]+)/gi,"promoting $1, $2, and $3").replace(/([^,]+) and ([^,]+) and ([^,\.]+)/g,"$1, $2, and $3").replace(/\b(\w+), (\w+) and (\w+)\b/g,"$1, $2, and $3")}function Me(r){return r.replace(/Spiritual benefits include enhancing ([^,]+), ([^,]+), and ([^,\.]+)/gi,"Spiritual benefits include enhancing $1, $2, and $3").replace(/Benefits include improving ([^,]+), ([^,]+), and ([^,\.]+)/gi,"Benefits include improving $1, $2, and $3").replace(/enhancing spiritual awareness and enhancing/gi,"enhancing spiritual awareness and").replace(/promoting inner peace and promoting/gi,"promoting inner peace and").replace(/improving meditation focus and improving/gi,"improving meditation focus and")}const N=2,We=5,Pe=We-N+1,L={NOVICE_MAX:5,APPRENTICE_MAX:10,MASTER_MAX:15},De={common:1,uncommon:2,rare:3,legendary:4},_e={quick:1,moderate:2,slow:3,ceremonial:4};function Ne(){return N+Math.floor(Math.random()*Pe)}function ze(r,e){const t=r.reduce((a,s)=>{const o=De[s.rarity],l=s.isSacred?1:0;return a+o+l},0),n=_e[e.timeRequired],i=t+n;return i<=L.NOVICE_MAX?"novice":i<=L.APPRENTICE_MAX?"apprentice":i<=L.MASTER_MAX?"master":"airbending_master"}function Be(r,e){const t=r.some(c=>c.rarity==="legendary"),n=r.some(c=>c.isSacred),i=e.timeRequired==="ceremonial",a=e.timeRequired==="slow";let s=.2;if(t||n?s=.8:i?s=.6:a&&(s=.4),Math.random()>s)return;const o=g(J);if(r.filter(c=>c.rarity==="legendary").length>0){const c=["transcendent awareness","spiritual purification","cosmic connection","elemental harmony","inner enlightenment"],d=c[Math.floor(Math.random()*c.length)];return`${o} Legendary ingredients provide additional benefits: enhancing ${d}.`}return o}class Ue{constructor(e,t,n){h(this,"ingredients");h(this,"techniques");h(this,"config");if(!e.length)throw new Error("CoreDishGenerator: Cannot initialize with empty ingredients array. At least one ingredient must be provided.");if(!t.length)throw new Error("CoreDishGenerator: Cannot initialize with empty techniques array. At least one technique must be provided.");this.ingredients=e,this.techniques=t,this.config=n}createDish(){try{const e=this.selectIngredientsByRole(),t=this.selectThematicTechnique();this.validateDishComposition(e);const n=W(we(e,t)),i=W(ye(e,t));return{name:n,description:i,ingredients:e,technique:t,servingSize:Ne(),difficulty:ze(e,t),spiritualBenefit:Be(e,t)}}catch(e){throw new Error(`CoreDishGenerator.createDish: Failed to generate dish - ${e instanceof Error?e.message:"Unknown error"}`)}}selectIngredientsByRole(){const e=this.config.compositionRules,t=[];for(const a of e.requiredRoles){const s=this.selectIngredientsForRole(a,1,e.maxIngredientsPerRole[a],!0);t.push(...s)}const n=this.config.ingredientCount.max-t.length;let i=0;for(const a of e.optionalRoles){if(i>=n)break;if(Math.random()<.6){const s=Math.min(e.maxIngredientsPerRole[a],n-i),o=this.selectIngredientsForRole(a,0,s,!1);t.push(...o),i+=o.length}}for(;t.length<this.config.ingredientCount.min&&!(this.config.ingredientCount.max-t.length<=0);){let s=!1;for(const o of[...e.requiredRoles,...e.optionalRoles]){const l=t.filter(d=>d.role===o).length,c=e.maxIngredientsPerRole[o];if(l<c){const d=this.selectIngredientsForRole(o,0,1,!1);if(d.length>0){t.push(...d),s=!0;break}}}if(!s)break}if(t.length<this.config.ingredientCount.min)throw new Error(`selectIngredientsByRole: Generated ${t.length} ingredients, minimum required is ${this.config.ingredientCount.min}. Available ingredient pool may be too constrained.`);return t}selectIngredientsForRole(e,t,n,i){const a=this.ingredients.filter(m=>m.role===e),s=this.config.compositionRules.enforceVegetarian?a.filter(m=>!["Eggs","Egg Whites","Butter","Milk","Cream","Creamy Sauce","Milk Powder"].includes(m.name)):a;if(s.length===0){if(i)throw new Error(`selectIngredientsForRole: No ingredients available for required role '${e}'`);return[]}const o=this.applyCulturalWeightBias(s),l=t+Math.floor(Math.random()*(n-t+1)),c=[],d=[...o];let y=0;const w=o.length*3;for(;c.length<l&&d.length>0&&y<w;){const m=Math.floor(Math.random()*d.length),p=d[m];this.canAddIngredient(p,c)&&c.push(p),d.splice(m,1),y++}return c.length<t&&!i,c}applyCulturalWeightBias(e){const t=this.config.culturalWeightBias,n=[];for(const i of e){const a=Math.max(1,Math.floor(i.culturalWeight*t));for(let s=0;s<a;s++)n.push(i)}return n}canAddIngredient(e,t){const n=this.config.compositionRules;return!(t.some(i=>i.name===e.name)||e.isSacred&&t.filter(a=>a.isSacred).length>=n.maxSacredIngredients||e.rarity==="legendary"&&(t.filter(a=>a.rarity==="legendary").length>=n.maxLegendaryIngredients||!this.config.allowLegendaryIngredients))}selectThematicTechnique(){const e=this.techniques.filter(i=>i.suitableForDishTypes.includes(this.config.dishType));if(e.length===0)throw new Error(`selectThematicTechnique: No techniques available for dish type '${this.config.dishType}'`);const t=[];for(const i of e){const a=Math.max(1,i.culturalSignificance);for(let s=0;s<a;s++)t.push(i)}const n=Math.floor(Math.random()*t.length);return t[n]}validateDishComposition(e){const t=this.config.compositionRules;if(e.length<this.config.ingredientCount.min)throw new Error(`validateDishComposition: Insufficient ingredients (${e.length}), minimum required: ${this.config.ingredientCount.min}`);if(e.length>this.config.ingredientCount.max)throw new Error(`validateDishComposition: Too many ingredients (${e.length}), maximum allowed: ${this.config.ingredientCount.max}`);const n=new Set(e.map(o=>o.role));for(const o of t.requiredRoles)if(!n.has(o))throw new Error(`validateDishComposition: Missing required ingredient role: ${o}`);const i=e.filter(o=>o.isSacred).length;if(i>t.maxSacredIngredients)throw new Error(`validateDishComposition: Too many sacred ingredients (${i}), maximum allowed: ${t.maxSacredIngredients}`);const a=e.filter(o=>o.rarity==="legendary").length;if(a>t.maxLegendaryIngredients)throw new Error(`validateDishComposition: Too many legendary ingredients (${a}), maximum allowed: ${t.maxLegendaryIngredients}`);const s=e.reduce((o,l)=>o+l.culturalWeight,0)/e.length;if(s<t.culturalWeightThreshold)throw new Error(`validateDishComposition: Insufficient cultural authenticity (${s.toFixed(1)}), minimum required: ${t.culturalWeightThreshold}`)}}const F=[{name:"Basmati Rice",category:"grain",role:"main",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Flour",category:"grain",role:"main",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Glutinous Rice",category:"grain",role:"main",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Noodles",category:"grain",role:"main",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Pastry",category:"grain",role:"main",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Rice",category:"grain",role:"main",rarity:"common",culturalWeight:8,isSacred:!1},{name:"Rice Flour",category:"grain",role:"main",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Roasted Barley Flour",category:"grain",role:"main",rarity:"uncommon",culturalWeight:9,isSacred:!1},{name:"Bamboo Shoots",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:9,isSacred:!1},{name:"Bean Sprouts",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Bell Peppers",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Cabbage",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Carrot",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Chayote",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Chrysanthemum Greens",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:9,isSacred:!1},{name:"Fiddlehead Ferns",category:"vegetable",role:"vegetable",rarity:"rare",culturalWeight:9,isSacred:!1},{name:"Lotus Root",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:10,isSacred:!1},{name:"Onion",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Oyster Mushroom",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Pickles",category:"vegetable",role:"garnish",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Potato",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:5,isSacred:!1},{name:"Red Cabbage",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Scallions",category:"vegetable",role:"garnish",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Seaweed",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Shiitake",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Snow Lotus Petals",category:"vegetable",role:"garnish",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Taro",category:"vegetable",role:"main",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Tomato",category:"vegetable",role:"vegetable",rarity:"common",culturalWeight:5,isSacred:!1},{name:"Water Chestnuts",category:"vegetable",role:"vegetable",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Yam",category:"vegetable",role:"main",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Almonds",category:"protein",role:"garnish",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Azuki Beans",category:"protein",role:"main",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Cashews",category:"protein",role:"garnish",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Coconut",category:"protein",role:"garnish",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Egg Whites",category:"protein",role:"main",rarity:"common",culturalWeight:2,isSacred:!1},{name:"Eggs",category:"protein",role:"main",rarity:"common",culturalWeight:2,isSacred:!1},{name:"Jackfruit",category:"protein",role:"main",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Lychee Nuts",category:"protein",role:"garnish",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Mung Beans",category:"protein",role:"main",rarity:"common",culturalWeight:8,isSacred:!1},{name:"Pine Nuts",category:"protein",role:"garnish",rarity:"rare",culturalWeight:9,isSacred:!1},{name:"Silken Tofu",category:"protein",role:"main",rarity:"uncommon",culturalWeight:9,isSacred:!1},{name:"Tofu",category:"protein",role:"main",rarity:"common",culturalWeight:9,isSacred:!1},{name:"Apple",category:"fruit",role:"fruit",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Banana",category:"fruit",role:"fruit",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Cloudberries",category:"fruit",role:"fruit",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Dried Apricots",category:"fruit",role:"fruit",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Goji Berries",category:"fruit",role:"garnish",rarity:"rare",culturalWeight:9,isSacred:!1},{name:"Longan Fruit",category:"fruit",role:"fruit",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Moon Peaches",category:"fruit",role:"fruit",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Raisins",category:"fruit",role:"garnish",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Butter",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:4,isSacred:!1},{name:"Crystal Cave Minerals",category:"seasoning",role:"seasoning",rarity:"rare",culturalWeight:10,isSacred:!0},{name:"Fruit Extracts",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Ginger",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:8,isSacred:!1},{name:"Himalayan Salt",category:"seasoning",role:"seasoning",rarity:"rare",culturalWeight:9,isSacred:!1},{name:"Jasmine Blossoms",category:"seasoning",role:"garnish",rarity:"rare",culturalWeight:10,isSacred:!0},{name:"Lemon Zest",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Lemongrass",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Milk Powder",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:4,isSacred:!1},{name:"Plum Filling",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Red Bean Paste",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:8,isSacred:!1},{name:"Rock Sugar",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Sacred Lotus Root",category:"seasoning",role:"seasoning",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Salt",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Soy Sauce",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Sugar",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:6,isSacred:!1},{name:"Sweet Fillings",category:"seasoning",role:"seasoning",rarity:"common",culturalWeight:7,isSacred:!1},{name:"Tea Leaves",category:"seasoning",role:"seasoning",rarity:"uncommon",culturalWeight:10,isSacred:!1},{name:"Toasted Sesame Seeds",category:"seasoning",role:"garnish",rarity:"uncommon",culturalWeight:7,isSacred:!1},{name:"Wild Honey",category:"seasoning",role:"seasoning",rarity:"rare",culturalWeight:9,isSacred:!1},{name:"Wind Flower Nectar",category:"seasoning",role:"seasoning",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Butter Tea",category:"liquid",role:"liquid",rarity:"uncommon",culturalWeight:10,isSacred:!1},{name:"Cream",category:"liquid",role:"liquid",rarity:"uncommon",culturalWeight:4,isSacred:!1},{name:"Creamy Sauce",category:"liquid",role:"liquid",rarity:"uncommon",culturalWeight:4,isSacred:!1},{name:"Milk",category:"liquid",role:"liquid",rarity:"common",culturalWeight:4,isSacred:!1},{name:"Sky Bison Milk",category:"liquid",role:"liquid",rarity:"legendary",culturalWeight:10,isSacred:!0},{name:"Soy Milk",category:"liquid",role:"liquid",rarity:"common",culturalWeight:8,isSacred:!1},{name:"Vegetable Broth",category:"liquid",role:"liquid",rarity:"common",culturalWeight:8,isSacred:!1},{name:"Yak Milk",category:"liquid",role:"liquid",rarity:"rare",culturalWeight:8,isSacred:!1}],Oe=F.filter(r=>!["Eggs","Egg Whites","Butter","Milk","Cream","Creamy Sauce","Milk Powder"].includes(r.name));function He(r=7,e=!0){return(e?Oe:F).filter(n=>n.culturalWeight>=r)}const z=[{name:"Steam-Whipped",description:"Using controlled air currents to whip ingredients while steaming",timeRequired:"moderate",culturalSignificance:9,category:"main_dish",suitableForDishTypes:["main_course","side_dish"]},{name:"Cloud-Braised",description:"Slow cooking in floating moisture clouds",timeRequired:"slow",culturalSignificance:8,category:"main_dish",suitableForDishTypes:["main_course","side_dish"]},{name:"Wind-Dried",description:"Dehydrating using carefully controlled air flows",timeRequired:"ceremonial",culturalSignificance:7,category:"ceremonial",suitableForDishTypes:["ceremonial_offering","dessert"]},{name:"Levitation-Cooked",description:"Cooking ingredients while suspended in air through airbending",timeRequired:"moderate",culturalSignificance:10,category:"ceremonial",suitableForDishTypes:["main_course","ceremonial_offering"]},{name:"Meditation-Infused",description:"Preparing food during deep meditation to infuse spiritual energy",timeRequired:"ceremonial",culturalSignificance:10,category:"ceremonial",suitableForDishTypes:["ceremonial_offering","beverage","dessert"]},{name:"Sky-Roasted",description:"Roasting at high altitudes using controlled air temperature",timeRequired:"moderate",culturalSignificance:6,category:"main_dish",suitableForDishTypes:["main_course","side_dish"]},{name:"Whisper-Steamed",description:"Gentle steaming using barely perceptible air movements",timeRequired:"slow",culturalSignificance:8,category:"main_dish",suitableForDishTypes:["main_course","side_dish","dessert"]}];function Ge(r=8){return z.filter(e=>e.category==="main_dish"&&e.culturalSignificance>=r&&e.suitableForDishTypes.includes("main_course"))}const S={INGREDIENT_COUNTS:{main_course:{min:3,max:5},side_dish:{min:2,max:4},dessert:{min:2,max:4},beverage:{min:1,max:3},ceremonial_offering:{min:4,max:7}},CULTURAL_THRESHOLDS:{standard:6},SACRED_LIMITS:{regular:1,ceremonial:2},LEGENDARY_LIMITS:{standard:1,ceremonial:1},CULTURAL_BIAS:{high:1.8}},je={main_course:{requiredRoles:["main","vegetable","seasoning"],optionalRoles:["garnish","liquid"],maxIngredientsPerRole:{main:1,vegetable:2,seasoning:2,fruit:1,liquid:1,garnish:1}},side_dish:{requiredRoles:["vegetable","seasoning"],optionalRoles:["garnish","fruit"],maxIngredientsPerRole:{main:0,vegetable:2,seasoning:1,fruit:1,liquid:1,garnish:1}},dessert:{requiredRoles:["fruit","seasoning"],optionalRoles:["garnish","liquid"],maxIngredientsPerRole:{main:1,vegetable:0,seasoning:2,fruit:2,liquid:1,garnish:1}},beverage:{requiredRoles:["liquid"],optionalRoles:["seasoning","fruit","garnish"],maxIngredientsPerRole:{main:0,vegetable:0,seasoning:2,fruit:1,liquid:1,garnish:1}},ceremonial_offering:{requiredRoles:["main","seasoning"],optionalRoles:["vegetable","fruit","garnish","liquid"],maxIngredientsPerRole:{main:1,vegetable:2,seasoning:2,fruit:2,liquid:1,garnish:2}}},q={air_nomads:{name:"Air Nomads",enforceVegetarian:!0,culturalWeightThreshold:S.CULTURAL_THRESHOLDS.standard,culturalWeightBias:S.CULTURAL_BIAS.high,allowedRarities:["common","uncommon","rare","legendary"],sacredIngredientLimits:{regular:S.SACRED_LIMITS.regular,ceremonial:S.SACRED_LIMITS.ceremonial},legendaryIngredientLimits:{regular:S.LEGENDARY_LIMITS.standard,ceremonial:S.LEGENDARY_LIMITS.ceremonial},excludedIngredients:["Eggs","Egg Whites","Butter","Milk","Cream","Creamy Sauce","Milk Powder"],preferredRoles:["vegetable","fruit","seasoning"]}};class Ve{static createRulesForNationAndDishType(e,t,n){const i=q[e];if(!i)throw new Error(`DishCompositionRuleFactory: Unknown nation key '${e}'`);const a=je[t];if(!a)throw new Error(`DishCompositionRuleFactory: Unknown dish type '${t}'`);const s=t==="ceremonial_offering",o=s?i.sacredIngredientLimits.ceremonial:i.sacredIngredientLimits.regular,l=s?i.legendaryIngredientLimits.ceremonial:i.legendaryIngredientLimits.regular,c={requiredRoles:a.requiredRoles,optionalRoles:a.optionalRoles,maxIngredientsPerRole:a.maxIngredientsPerRole,maxSacredIngredients:o,maxLegendaryIngredients:l,culturalWeightThreshold:i.culturalWeightThreshold,enforceVegetarian:i.enforceVegetarian};return n?{...c,...n}:c}static createAirNomadRules(e){return this.createRulesForNationAndDishType("air_nomads",e)}}class Ye{static filterByNationProfile(e,t){const n=q[t];if(!n)throw new Error(`IngredientFilterUtils: Unknown nation key '${t}'`);let i=[...e];return n.enforceVegetarian&&n.excludedIngredients&&(i=i.filter(a=>!n.excludedIngredients.includes(a.name))),i=i.filter(a=>a.culturalWeight>=n.culturalWeightThreshold),i=i.filter(a=>n.allowedRarities.includes(a.rarity)),i}static applyCulturalWeightBias(e,t){if(t===1)return e;const n=[];for(const i of e){const s=i.culturalWeight/10,o=Math.pow(s,t-1),l=Math.max(1,Math.round(o*3));for(let c=0;c<l;c++)n.push(i)}return n}static validateIngredientConstraints(e,t,n,i){return!(e.rarity==="legendary"&&(!i||t.filter(s=>s.rarity==="legendary").length>=n.maxLegendaryIngredients)||e.isSacred&&t.filter(s=>s.isSacred).length>=n.maxSacredIngredients||t.some(a=>a.name===e.name))}}class b extends Ue{constructor(t="main_course",n=!1){const i=b.createConfigForDishType(t,n),a=b.filterAuthenticIngredients(t),s=b.filterAuthenticTechniques(t);super(a,s,i);h(this,"authenticIngredients");h(this,"authenticTechniques");this.authenticIngredients=a,this.authenticTechniques=s}static createConfigForDishType(t,n){const i=Ve.createAirNomadRules(t),a=S.INGREDIENT_COUNTS[t],o=q.air_nomads.culturalWeightBias;return{dishType:t,compositionRules:i,ingredientCount:a,rarityDistribution:{common:.5,uncommon:.35,rare:.12,legendary:.03},allowLegendaryIngredients:n,culturalWeightBias:o}}static filterAuthenticIngredients(t){let n=Ye.filterByNationProfile(F,"air_nomads");if(t==="ceremonial_offering"){const i=n.filter(o=>o.isSacred),a=He(8,!0),s=[...i];for(const o of a)s.some(l=>l.name===o.name)||s.push(o);n=s}return n}static filterAuthenticTechniques(t){const n=z.filter(i=>i.suitableForDishTypes.includes(t));return t==="main_course"?Ge(7):t==="ceremonial_offering"?n.filter(i=>i.category==="ceremonial"||i.culturalSignificance>=8):n.filter(i=>i.culturalSignificance>=6)}static createMainCourse(t=!1){return new b("main_course",t)}static createSideDish(t=!1){return new b("side_dish",t)}static createCeremonialOffering(t=!0){return new b("ceremonial_offering",t)}getAuthenticIngredients(){return[...this.authenticIngredients]}getAuthenticTechniques(){return[...this.authenticTechniques]}}const Ze='Click "Generate Dish" to create an Air Nomad culinary masterpiece!',Xe="🌪️ Consulting the Ancient Scrolls...";class Je{constructor(e){h(this,"container");const t=document.getElementById(e);if(!t)throw new Error(`DishDisplay: Cannot find element with id '${e}'. Ensure the target element exists in the DOM.`);this.container=t}renderDish(e){try{if(!e){this.renderEmptyState();return}this.renderCompleteDish(e)}catch(t){throw new Error(`DishDisplay.renderDish: Failed to render dish - ${t instanceof Error?t.message:"Unknown rendering error"}`)}}showGeneratingState(){this.container.innerHTML=`
      <div class="dish-display generating">
        <p>${Xe}</p>
      </div>
    `}renderEmptyState(){this.container.innerHTML=`
      <div class="dish-display empty">
        <p>${Ze}</p>
      </div>
    `}renderCompleteDish(e){const t=this.formatIngredientsHtml(e.ingredients),n=this.formatSpiritualBenefitHtml(e.spiritualBenefit);this.container.innerHTML=`
      <div class="dish-display">
        <h2>${e.name}</h2>
        <p class="description">${e.description}</p>
        
        <div class="dish-details">
          <div class="ingredients">
            <h3>Ingredients:</h3>
            <ul>
              ${t}
            </ul>
          </div>
          
          <div class="technique">
            <h3>Technique:</h3>
            <p><strong>${e.technique.name}</strong></p>
            <p>${e.technique.description}</p>
          </div>
          
          <div class="metadata">
            <p><strong>Difficulty:</strong> ${e.difficulty}</p>
            <p><strong>Serves:</strong> ${e.servingSize}</p>
            ${n}
          </div>
        </div>
      </div>
    `}formatIngredientsHtml(e){return e.map(t=>`<li class="rarity-${t.rarity}">${t.name}</li>`).join("")}formatSpiritualBenefitHtml(e){return e?`<p><strong>Spiritual Benefit:</strong> ${e}</p>`:""}}const P="generate-button",Qe="dish-container",Ke="Generating...",et="Generate Air Nomad Dish",tt=500;class nt{constructor(){h(this,"generator");h(this,"dishDisplay");h(this,"generateButton");h(this,"currentDish",null);try{this.generator=b.createMainCourse(),this.dishDisplay=new Je(Qe);const e=document.getElementById(P);if(!e)throw new Error(`App: Cannot find generate button with id '${P}'. Ensure the button exists in the DOM.`);this.generateButton=e,this.attachEventListeners()}catch(e){throw new Error(`App initialization failed: ${e instanceof Error?e.message:"Unknown initialization error"}`)}}attachEventListeners(){this.generateButton.addEventListener("click",()=>{this.handleDishGeneration()})}async handleDishGeneration(){try{this.setGeneratingState(),await this.delayExecution(tt),this.currentDish=this.generator.createDish(),this.dishDisplay.renderDish(this.currentDish),this.resetButtonState()}catch(e){throw this.resetButtonState(),new Error(`handleDishGeneration: Failed to generate dish - ${e instanceof Error?e.message:"Unknown generation error"}`)}}setGeneratingState(){this.generateButton.disabled=!0,this.generateButton.textContent=Ke,this.dishDisplay.showGeneratingState()}resetButtonState(){this.generateButton.disabled=!1,this.generateButton.textContent=et}delayExecution(e){return new Promise(t=>setTimeout(t,e))}}document.addEventListener("DOMContentLoaded",()=>{try{new nt}catch(r){console.error("Failed to initialize Air Nomad Culinary Dash application:",r)}});
