(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function l(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=l(a);fetch(a.href,r)}})();const O=["Hearty","Delicate","Crispy","Savory"],$=["Delight","Feast","Surprise","Medley"],U={byIngredientHint:{"Moon Peach":["Grown only in the light of a full moon..."],"Arctic Char":["A staple for warriors traversing the frozen wastes..."]},generic:["A dish with a long and storied history..."],_placeholders:{Geographical_Feature:["Whispering Mountains","Singing Valley"]}},T={Spiritual:{adj:["Spirit_Touched"],conceptMod:"infused with a subtle spiritual energy.",plating:"minimalist, natural elements.",loreHints:["meditation"]},Royal:{adj:["Regal Dragon's"],conceptMod:"fit for the highest royalty.",plating:"elaborate, often with intricate carvings.",loreHints:["coronation"]}},k={ingredients:{dairy:[{name:"Sky Bison Yoghurt",type:"dairy",rolePreference:["primary","liquid","base"],canBeBase:!0,weight:"medium",rawCompatible:!0,tags:["creamy","fermented","air_nomad","staple","tangy","mild","vegetarian","dairy","sweet_compatible","nectar_base","dessert_base_ok","beverage_component","liquid_ish","sweet_sour_balance"],rarity:"common",flavorNotes:["creamy","tangy","mildly_sweet","refreshing","silken","yogurt-tang","cool-touch"],loreHints:["sky_bison","nomadic_spirit"]}],flavoringsHerbsSpices:[{name:"Lavender Buds",type:"herb",rolePreference:["accent","garnish","seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["floral","aromatic","air_nomad","delicate","calming","herb","sweet_compatible","sweet_herb","infusible_herb","beverage_component","fragile_garnish"],rarity:"uncommon",flavorNotes:["floral","sweet_herbaceous","calming_aroma","gentle-perfume","airy-fragrance"],loreHints:["meditation","temple_garden"]},{name:"Whisperwind Petals",type:"Edible Flower",rolePreference:["garnish","accent","seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["air_nomad","floral","delicate"],rarity:"uncommon",flavorNotes:["subtle_floral","airy_fragrance","perfume-like_sweetness"],loreHints:["meditation_gardens"]}],fruitsVegetablesFungi:[{name:"Moon Peach",type:"fruit",rolePreference:["primary","garnish","base"],canBeBase:!0,weight:"medium",rawCompatible:!0,tags:["sweet","juicy","air_nomad","delicate","stone_fruit","fruit","nectar_source","sweet_compatible","dessert_fruit","dessert_primary_ok","dessert_base_ok","beverage_component","fruit_puree_candidate","fragile_garnish","honeyed"],rarity:"common",flavorNotes:["honeyed_sweet","floral_aroma","velvety_texture","dream-like","succulent","luscious"],loreHints:["Moon Peach"]},{name:"Sky Sprouts",type:"Vegetable",rolePreference:["accent","garnish","base"],canBeBase:!0,weight:"light",rawCompatible:!0,tags:["air_nomad","fresh","crisp","peppery"],rarity:"common",flavorNotes:["crisp_snap","fresh_green","subtly_peppery"],loreHints:["hanging_gardens"]},{name:"Aero-Melon",type:"Fruit",rolePreference:["primary","base"],canBeBase:!0,weight:"light",rawCompatible:!0,tags:["air_nomad","fruit","light","refreshing"],rarity:"uncommon",flavorNotes:["light_sweetness","fluffy_texture","watery"],loreHints:["sky_bison_treat"]},{name:"Summit Ginseng",type:"Root Vegetable",rolePreference:["accent","seasoning"],canBeBase:!1,weight:"medium",rawCompatible:!1,tags:["air_nomad","restorative","bitter","sweet"],rarity:"rare",flavorNotes:["complex_bitter-sweet","warming_sensation","earthy_aroma"],loreHints:["mountain_hermit"]}],grains:[{name:"Barley Tsampa",type:"grain",rolePreference:["base"],canBeBase:!0,weight:"heavy",rawCompatible:!1,tags:["staple","earthy","air_nomad","hearty","roasted_flour","grain","sweet_compatible","heavy_grain","solid_food_component","nutty"],rarity:"common",flavorNotes:["nutty","toasted","earthy_sweet","wholesome","robust","sustaining"],loreHints:["guru_pathik","travel_food"]}]},cookingStyles:[{name:"gentle steaming",tags:["airNomadTradition","steaming"]}],adjectives:["Sky Temple","Meditative","Gentle Wind"],nameFormats:[{pattern:"{themeAdj} {nationAdj} {mainIngredient} {format}",slots:{themeAdj:["Sacred"],nationAdj:["Skyborne"],mainIngredient:"use_selected_main_ingredient",format:"use_dish_format"}}],platingNotes:["Served with minimalist elegance on simple, unadorned pottery."],nationDishTypeProfiles:{Dessert:{allowedTags:["fruit","sweet_compatible"],disallowedTags:["pungent_spice"]}}},H={ingredients:{animalProducts:[{name:"Arctic Char",type:"protein",rolePreference:["primary"],canBeBase:!0,weight:"medium",rawCompatible:!0,tags:["fish","seafood","water_tribe"],rarity:"common",flavorNotes:["rich_omega"],loreHints:["arctic_hunt"]},{name:"Sea-Prickle Roe",type:"Seafood (Roe)",rolePreference:["primary","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["water_tribe","seafood","delicacy","briny","creamy"],rarity:"rare",flavorNotes:["rich_creamy_brine","buttery_texture"],loreHints:["chieftain_feast"]},{name:"Giant Crab Meat",type:"Seafood (Crustacean)",rolePreference:["primary"],canBeBase:!0,weight:"heavy",rawCompatible:!1,tags:["water_tribe","seafood","sweet","succulent"],rarity:"uncommon",flavorNotes:["naturally_sweet","savory","firm_texture"],loreHints:["coastal_celebration"]}],plants:[{name:"Sea Plums",type:"fruit",rolePreference:["accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["fruit","tart","water_tribe"],rarity:"uncommon",flavorNotes:["briny_tart"],loreHints:["coastal_foraging"]},{name:"Glacier Kelp",type:"Seaweed / Vegetable",rolePreference:["primary","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["water_tribe","vegetable","seaweed","crisp","briny"],rarity:"uncommon",flavorNotes:["crisp_crunch","clean_brine","subtle_sea-sweetness"],loreHints:["southern_lights_snack"]},{name:"Bogberries (Preserved)",type:"Fruit",rolePreference:["accent","garnish"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["water_tribe","swamp","fruit","tart","preserved"],rarity:"common",flavorNotes:["intense_tartness","earthy_undertone","chewy_texture"],loreHints:["foggy_swamp_staple"]}]},cookingStyles:[{name:"boiling",tags:["waterTribeTradition","soupFriendly"]}],adjectives:["Frozen Tundra","Arctic Moon","Ocean Spirit"],nameFormats:[{pattern:"{nationAdj} {mainIngredient} Stew",slots:{nationAdj:["Frozen Deep"],mainIngredient:"use_selected_main_ingredient"}}],platingNotes:["Presented in sturdy, hand_carved wooden bowls."],nationDishTypeProfiles:{"Soup/Stew":{allowedTags:["fish","seafood"],disallowedTags:[]}}},R={ingredients:{grains:[{name:"Golden Terrace Rice",type:"grain",rolePreference:["base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["staple","earth_kingdom","earthy","nutty","versatile","grain","sweet_compatible","light_grain","can_be_sweetened_neutral","solid_food_component","savory_compatible","soup_compatible","stew_compatible","fluffy"],rarity:"common",flavorNotes:["nutty","slightly_sweet","fluffy_texture","absorbent","golden-hue","aromatic-grain"],loreHints:["ba_sing_se","harvest_festival"]}],fruitsVegetablesFungi:[{name:"Fermented Lotus Root Chips",type:"vegetable",rolePreference:["primary","accent","garnish"],canBeBase:!0,weight:"light",rawCompatible:!0,tags:["root_veg","crunchy","earth_kingdom","fermented","tangy","vegetable","fermented_savory","umami","portable_snack_form","street_food_snack","crispy"],rarity:"uncommon",flavorNotes:["tangy_sour","crisp_texture","umami_hint","savory-crunch","pickled-earth"],loreHints:["ancient_preservation","earth_bender_snack"]},{name:"Cactus Juice",type:"liquid",rolePreference:["primary","liquid","base"],canBeBase:!0,weight:"medium",rawCompatible:!0,tags:["earth_kingdom","liquid","sweet_compatible","nectar_base","dessert_base_ok","beverage_component","liquid_ish","sweet_sour_balance"],rarity:"common",flavorNotes:["sweet_sour","refreshing","silken","yogurt-tang","cool-touch"],loreHints:["sokka_quencher"]},{name:"Badgermole Truffles",type:"Fungus",rolePreference:["accent","seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["earth_kingdom","fungus","rare","pungent","earthy"],rarity:"epic",flavorNotes:["intense_musky_earth","powerful_aroma"],loreHints:["badgermole_delicacy"]},{name:"Omashu Jingu-Peaches",type:"Fruit",rolePreference:["primary","base"],canBeBase:!0,weight:"heavy",rawCompatible:!0,tags:["earth_kingdom","fruit","juicy","sweet"],rarity:"uncommon",flavorNotes:["explosively_juicy","honeyed_sweetness","firm_flesh"],loreHints:["king_bumi_favorite"]},{name:"Jade Vine Shoots",type:"Vegetable",rolePreference:["primary","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["earth_kingdom","vegetable","crisp","tender","noble"],rarity:"uncommon",flavorNotes:["tender_crisp","clean_green_flavor","mildly_sweet"],loreHints:["ba_sing_se_feast"]}],proteins:[{name:"Jennamite",type:"crystal",rolePreference:["primary","liquid","base"],canBeBase:!0,weight:"medium",rawCompatible:!0,tags:["earth_kingdom","liquid","sweet_compatible","nectar_base","dessert_base_ok","beverage_component","liquid_ish","sweet_sour_balance"],rarity:"common",flavorNotes:["sweet_sour","refreshing","silken","yogurt-tang","cool-touch"],loreHints:["crystal_caves"]},{name:"Sand-Shark Jerky",type:"Meat",rolePreference:["primary","snack"],canBeBase:!1,weight:"medium",rawCompatible:!0,tags:["earth_kingdom","desert","meat","spicy","jerky"],rarity:"common",flavorNotes:["leathery_chew","smoky_spicy_salt"],loreHints:["sandbender_travel_food"]}]},cookingStyles:[{name:"hearty roasting",tags:["earthKingdomTradition","roasting"]}],adjectives:["Earthen Heart","Stone Fortress","Ba Sing Se Imperial"],nameFormats:[{pattern:"{nationAdj} {mainIngredient} {format}",slots:{nationAdj:["Ba Sing Se Grand"],mainIngredient:"use_selected_main_ingredient",format:"use_dish_format"}}],platingNotes:["Served generously on sturdy earthenware or heavy pottery."],nationDishTypeProfiles:{"Main Course":{allowedTags:["grain","protein","vegetable","earthy","hearty","savory_compatible"],disallowedTags:["fiery","delicate","floral"]}}},L={ingredients:{grains:[{name:"Dragon's Breath Infused Rice",type:"grain",rolePreference:["base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["spicy_hint","fire_nation","aromatic","staple","grain","sweet_compatible","light_grain","solid_food_component","savory_compatible","fragrant_spice","soup_compatible","stew_compatible","fluffy"],rarity:"uncommon",flavorNotes:["fluffy_texture","subtle_smoky","warm_spice_aroma","saffron_color","fragrant","lightly-spiced"],loreHints:["volcanic_steam","sun_warrior_ritual"]}],fruitsAndVegetables:[{name:"Ember Chili",type:"spice",rolePreference:["seasoning","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["vegetable","chili","spicy","fiery","fire_nation","staple","versatile_heat","spice","pungent_spice","savory_compatible"],rarity:"common",flavorNotes:["varied_fiery_heat","smoky_undertones","fruity_notes_in_some","sharp_spice","blazing","tingling"],loreHints:["sozins_comet_pepper","spice_tolerance_test"]},{name:"Fire Flakes",type:"spice",rolePreference:["seasoning","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["fire_nation","spice","spicy","fiery","savory_compatible"],rarity:"common",flavorNotes:["spicy_fiery_heat","smoky_undertones","fruity_notes_in_some","sharp_spice","blazing","tingling"],loreHints:["spice_trade"]},{name:"Soot-Lemons",type:"Fruit",rolePreference:["accent","seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["fire_nation","fruit","sour","smoky"],rarity:"uncommon",flavorNotes:["intense_sour","smoky_zest"],loreHints:["volcanic_citrus"]},{name:"Obsidian Beans",type:"Legume / Protein",rolePreference:["primary","base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["fire_nation","protein","legume","hearty","staple"],rarity:"common",flavorNotes:["deep_earthy_flavor","creamy_texture"],loreHints:["colony_staple_food"]}],grainsAndNoodles:[{name:"Sizzling Rice",type:"grain",rolePreference:["base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["staple","fire_nation","earthy","nutty","versatile","grain","sweet_compatible","light_grain","can_be_sweetened_neutral","solid_food_component","savory_compatible","soup_compatible","stew_compatible","fluffy"],rarity:"common",flavorNotes:["nutty","slightly_sweet","fluffy_texture","absorbent","golden-hue","aromatic-grain"],loreHints:["ember_island_specialty"]},{name:"Volcanic Glass Noodles",type:"Noodle",rolePreference:["base","primary"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["fire_nation","noodle","chewy","absorbent"],rarity:"uncommon",flavorNotes:["slippery_springy_texture","absorbent"],loreHints:["geothermal_cooking"]}],spicesAndSeasonings:[{name:"Dragon Pepper",type:"spice",rolePreference:["seasoning","accent"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["fire_nation","spice","spicy","fiery","savory_compatible"],rarity:"common",flavorNotes:["spicy_fiery_heat","smoky_undertones","fruity_notes_in_some","sharp_spice","blazing","tingling"],loreHints:["sun_warrior_ritual"]},{name:"Fire-Flake Salt",type:"Salt",rolePreference:["seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["fire_nation","salt","spicy","mineral"],rarity:"rare",flavorNotes:["sharp_saltiness","fiery_finish"],loreHints:["ember_island_salt_pans"]}]},cookingStyles:[{name:"grilling over open flames",tags:["fireNationTradition","grilling"]}],adjectives:["Volcanic Peak","Ember Island","Inferno Kissed"],nameFormats:[{pattern:"{nationAdj} {mainIngredient}",slots:{nationAdj:["Fiery Soul's"],mainIngredient:"use_selected_main_ingredient"}}],platingNotes:["Presented with dramatic flair on dark, heavy plates."],nationDishTypeProfiles:{"Main Course":{allowedTags:["grain","protein","vegetable","spicy","fiery","smoky","umami","savory_compatible"],disallowedTags:["delicate","floral"]}}},F={ingredients:{general:[{name:"Artisan Sourdough",type:"grain",rolePreference:["base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["bread","united_republic","cafe_staple","grain","can_be_sweetened_neutral","solid_food_component","crispy_bread_component","savory_compatible"],rarity:"common",flavorNotes:["tangy_sour","chewy_crust","airy-crumb","rustic-aroma"],loreHints:["republic_city_bakery"]}],fusionAndModern:[{name:"Cabbage Corp Kimchi",type:"fermented",rolePreference:["base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["united_republic","fusion","fermented","savory_compatible"],rarity:"common",flavorNotes:["tangy_sour","fermented_flavor"],loreHints:["cabbage_corp_product"]},{name:"Republic City 'Everything' Spice",type:"Spice Blend",rolePreference:["seasoning"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["united_republic","fusion","spice_blend","savory"],rarity:"common",flavorNotes:["complex_savory_blend","toasted_sesame","garlic_notes"],loreHints:["street_food_secret"]},{name:"Industrial Miso Paste",type:"Condiment / Paste",rolePreference:["binder","seasoning","base"],canBeBase:!0,weight:"medium",rawCompatible:!1,tags:["united_republic","fusion","umami","paste"],rarity:"common",flavorNotes:["deep_salty_umami","fermented_flavor"],loreHints:["future_industries_canteen"]},{name:"Pro-Bender's Energy Gel",type:"Sweetener / Snack",rolePreference:["accent","binder"],canBeBase:!1,weight:"light",rawCompatible:!0,tags:["united_republic","modern","sweetener","processed"],rarity:"common",flavorNotes:["artificial_fruit_flavor","sugary_boost","gelatinous"],loreHints:["pro_bending_snack"]}]},cookingStyles:[{name:"fusion cuisine (primary)",tags:["unitedRepublicModern","fusion"]}],adjectives:["Republic City Metro","Modern Fusion","Avatar Korra's Era"],nameFormats:[{pattern:"{adj} {mainIngredient1}_{mainIngredient2} Fusion",slots:{adj:["Dynamic"],mainIngredient1:"use_selected_main_ingredient",mainIngredient2:"use_selected_secondary_ingredient"}}],platingNotes:["Modern, artistic, and eclectic presentation."],nationDishTypeProfiles:{"Main Course":{allowedTags:["grain","noodle","protein","vegetable","fusion","umami","spicy","savory_compatible"],disallowedTags:["delicate","floral"]}}},M={ingredients:{general:[{name:"Luminous Fungi Clusters",type:"fungi",rolePreference:["primary","garnish","base"],canBeBase:!0,weight:"light",rawCompatible:!0,tags:["spirit_world","ethereal","glowing","mystical","umami_light","fungi","sweet_compatible","dessert_base_ok","spiritual_essence","beverage_component","delicate","shifting_texture"],rarity:"epic",flavorNotes:["delicate_umami","moonlight_taste","shifting_texture","faintly_sweet","otherworldly","translucent","pulsing"],loreHints:["Luminous Fungi Clusters"]}]},cookingStyles:[{name:"naturally occurring/manifesting",tags:["spiritWorldNature","ethereal","uniqueSpirit","no_cook"]}],adjectives:["Spirit Grove","Luminous Path","Whispering Woods'"],nameFormats:[{pattern:"{adj} {mainIngredient} Nectar",slots:{adj:["Glimmering"],mainIngredient:"use_selected_main_ingredient"}}],platingNotes:["Naturally beautiful and seemingly effortless presentation."],nationDishTypeProfiles:{Nectar:{allowedTags:["ethereal","sweet","fruit","nectar_source","spiritual_essence","fungi","liquid_ish","delicate","subtle","beverage_component","infusible_herb","creamy"],disallowedTags:["solid_food_component","pungent_spice","savory_scramble","strong_fish"]}}};let C=Math.random;function G(e){let t=0;for(let l=0;l<e.length;l++)t=(t<<5)-t+e.charCodeAt(l),t|=0;return function(){return t=(1664525*t+1013904223)%2**32,t/2**32}}function q(e){e?(console.log(`Using seeded RNG with seed: "${e}"`),C=G(e)):(console.log("Using standard RNG (Math.random)."),C=Math.random)}function f(e){if(!(!e||!Array.isArray(e)||e.length===0))return e[Math.floor(C()*e.length)]}function W(e,t){return e=Math.ceil(e),t=Math.floor(t),e>t?e:Math.floor(C()*(t-e+1))+e}const z=Object.freeze({FIRE:"Fire Nation",WATER:"Water Tribes",AIR:"Air Nomads",EARTH:"Earth Kingdom",SPIRIT:"Spirit World",REPUBLIC:"United Republic"}),E=Object.freeze({MAIN_COURSE:"Main Course",SIDE_DISH:"Side Dish",DESSERT:"Dessert",SOUP:"Soup",SALAD:"Salad",BEVERAGE:"Beverage",NECTAR:"Nectar",SAUCE_CONDIMENT:"Sauce/Condiment"});Object.freeze(Object.fromEntries(Object.entries(z).map(([e,t])=>[t,e])));const j=(e,t=!1)=>e&&e.name?t?e.name.split(" (")[0]:e.name:"Unknown Ingredient",V=e=>e&&Array.isArray(e.type)?e.type:typeof e.type=="string"?[e.type]:[],D=e=>e&&Array.isArray(e.tags)?e.tags:[],K=e=>e&&e.rarity?e.rarity:"common",J=e=>e&&Array.isArray(e.flavorNotes)?e.flavorNotes:[];function Q(e){if(!e)return!1;const t=D(e),l=J(e),o=V(e);return t.includes("sweet_compatible")||t.includes("dessert_fruit")||t.includes("sweet")||l.some(a=>a.includes("sweet"))||o.includes("sweetener")}function x(e,t,l,o,a){var c,d;if(!e)return!1;const r=D(e);if(r.includes("placeholder"))return!0;const i=o.length>0?o[0]:null,n=i?(d=(c=a[i])==null?void 0:c.nationDishTypeProfiles)==null?void 0:d[l]:null;if(n){if(n.disallowedTags&&n.disallowedTags.some(s=>r.includes(s)))return!1;n.allowedTags&&n.allowedTags.some(s=>r.includes(s))}return l==="Soup/Stew"&&t==="base"&&r.some(s=>["liquid_base","liquid_ish","broth_potential"].includes(s)),["Dessert","Nectar","Beverage"].includes(l)&&(t==="base"||t==="primary")&&Q(e),!0}function Z(e,t,l){const o={airNomads:k,waterTribes:H,earthKingdom:R,fireNation:L,unitedRepublic:F,spiritWorld:M};let a=[],r={},i=[],n=[];const c=Object.keys(o).reduce((s,u)=>{if(o[u].ingredients){const m=u.replace(/([A-Z])/g," $1").replace(/^./,p=>p.toUpperCase());s[m]=u}return s},{});e.forEach(s=>{const u=c[s];u&&o[u]&&(i.push(u),n.push(s),r[u]=o[u],Object.values(o[u].ingredients).forEach(m=>{Array.isArray(m)&&a.push(...m.map(p=>({...p,sourceNation:s,sourceNationKey:u})))}))});let d=a.filter(s=>x(s,"any",t,i,o));return d=[...new Map(d.map(s=>[j(s),s])).values()],{availableIngredientObjects:d,selectedNationsData:r,finalNationKeys:i,nationDisplayNames:n}}function Y(e,t,l,o,a){let r,i=t.filter(c=>{const d=j(c);if(l.has(d)){const s=K(c);return s!=="common"&&s!=="uncommon"}return!0});if(i.length===0)return;const n=o.filter(c=>a[c]===0);if(o.length>1&&n.length>0){const c=f(n);let d=i.filter(s=>s.sourceNationKey===c);d.length>0&&(r=f(d))}if(!r){let c=o&&o.length>0?o[0]:null,d=i.filter(s=>s.sourceNationKey===c);r=f(d.length>0?d:i)}return r}const B=(e,t=!1)=>e&&e.name?t?e.name.split(" (")[0]:e.name:"Unknown Ingredient",A=e=>e&&Array.isArray(e.tags)?e.tags:[],X=e=>e&&Array.isArray(e.flavorNotes)?e.flavorNotes:[];function ee(e,t){if(typeof e!="string")return"";let l=e;return l=l.replace(/\{(.*?)\}/g,(o,a)=>{const r=a.trim();if(t.hasOwnProperty(r)){let i=t[r];return typeof i=="object"&&i!==null&&i.name&&(i=B(i,!0)),String(i)}return o}),l.replace(/\{([A-Za-z_]+)\}/g,(o,a)=>t[a]!==void 0?String(t[a]):`[${a.replace(/_/g," ").toLowerCase()}]`)}function te(e,t,l,o,a,r,i){let n=[];const c=r&&r.length>0?r[0]:null,d=c?e[c]:null,s=i&&i.length>0?i[0]:"Elemental",u=T[a];let m={dishType:l,format:o,mainIngredient:"Essence",secondaryIngredient:"Whispers",themeAdj:u&&Array.isArray(u.adj)?f(u.adj):"",nationAdj:d&&Array.isArray(d.adjectives)?f(d.adjectives):s.split(" ")[0],flavorAdj:f(O.filter(g=>!g.endsWith("y")&&!g.endsWith("ing")&&g.length>5))||"Flavorful",culturalSymbol:"Elemental Harmony",avatarName:f(["Roku","Kyoshi","Yangchen","Aang","Korra","Wan"]),emotion:f(["Joyful","Nostalgic","Spirited","Bold","Comforting"]),mainIngredient1:"Component A",mainIngredient2:"Component B"};const p=t.find(g=>g&&g.role==="primary"&&!A(g).includes("placeholder")),h=t.find(g=>g&&g.role==="base"&&!A(g).includes("placeholder"));let y=p||h;y?m.mainIngredient=B(y,!0):m.mainIngredient=f($),m.mainIngredient1=m.mainIngredient;let b=t.find(g=>g&&g.role==="accent"&&!A(g).includes("placeholder")&&B(g)!==B(y));b?m.secondaryIngredient=B(b,!0):m.secondaryIngredient=(X(y)[0]||"Subtle").split("_")[0]+" Notes",m.mainIngredient2=m.secondaryIngredient,r&&r.length>0&&r.forEach(g=>{e[g]&&e[g].nameFormats&&n.push(...e[g].nameFormats)}),u&&u.nameFormats&&n.push(...u.nameFormats);let v=f(n.filter(g=>g&&g.pattern));return v||(v={pattern:"{nationAdj} {mainIngredient} {format}",slots:{}}),ee(v.pattern,m).replace(/\s+/g," ").trim()||"Unnamed Culinary Creation"}const re=(e,t=!1)=>e&&e.name?t?e.name.split(" (")[0]:e.name:"Unknown Ingredient",ne=e=>e&&Array.isArray(e.tags)?e.tags:[],ae=e=>e&&Array.isArray(e.loreHints)?e.loreHints:[];function ie(e,t,l,o,a,r){const i=U||{byIngredientHint:{},generic:[],_placeholders:{}};let n=[];const c=i._placeholders,d=t&&t.length>0?t[0]:"an unknown land";if(e.filter(m=>m&&!ne(m).includes("placeholder")).forEach(m=>{const p=re(m,!0),h=ae(m);i.byIngredientHint[p]&&n.push({text:f(i.byIngredientHint[p]),priority:.5}),h.forEach(y=>{i.byIngredientHint[y]&&n.push({text:f(i.byIngredientHint[y]),priority:1})})}),i.generic&&n.push({text:f(i.generic),priority:3}),n.length===0)return"The history of this dish is shrouded in delicious mystery.";n.sort((m,p)=>m.priority-p.priority);let s=n[0].text,u={nation_name:d,Dish_Name:r,Dish_Type:a.toLowerCase(),...Object.keys(c).reduce((m,p)=>(c[p]&&Array.isArray(c[p])&&(m[p]=f(c[p])),m),{})};return s.replace(/\{(\w+)\}/g,(m,p)=>u[p]||m)}function oe(e,t,l,o,a,r,i,n){let c=[],d=[],s=i.join(" and "),u=l.toLowerCase();c.push(`A ${u} creation that embodies the distinctive spirit of ${s}.`);const m=a&&T[a];m&&m.conceptMod&&c.push(m.conceptMod);let p=`This dish is brought to life through traditional techniques, honoring the traditions of ${i.join(" and ")}.`;d.push(p);let h="";const y=r&&r.length>0?r[0]:"earthKingdom",b=n[y];b&&b.platingNotes&&(h="Presentation is an art form here. "+f(b.platingNotes)),d.push(h);const v=c.join(" "),_=d.join(" ");return{concept:v,notes:_}}const P=(e,t=!1)=>e&&e.name?t?e.name.split(" (")[0]:e.name:"Unknown Ingredient";function se(e,t,l,o){const a={airNomads:k,waterTribes:H,earthKingdom:R,fireNation:L,unitedRepublic:F,spiritWorld:M},{availableIngredientObjects:r,selectedNationsData:i,finalNationKeys:n,nationDisplayNames:c}=Z(t,e);let d=[],s=new Set,u={};n.forEach(_=>u[_]=0);const p={...{base:1,primary:1,seasoning:1,accent:1,garnish:1}};[E.BEVERAGE,E.NECTAR,E.SAUCE_CONDIMENT].includes(e)&&(p.primary=W(0,1),p.garnish=0);for(const _ in p){let g=p[_];for(;g>0;){let S=r.filter(N=>x(N,_,e,n,a)?N.rolePreference&&N.rolePreference.includes(_)||_==="base"&&N.canBeBase:!1),w=Y(_,S,s,n,u);!w&&S.length>0&&(w=f(S.filter(N=>!s.has(P(N))))),w&&(w.role=_,d.push(w),s.add(P(w)),n.includes(w.sourceNationKey)&&u[w.sourceNationKey]++),g--}}const h=te(i,d,e,l,o,n,c),{concept:y,notes:b}=oe(h,d,e,l,o,n,c,a),v=ie(d,c,n,o,e,h);return{name:h,concept:y,ingredients:d,notes:b,lore:v}}function I(e){if(typeof e!="string")return e;let t=e;const l="aeiou";return t=t.replace(/\b(an)\s+([uU][nN][iI][qQ][uU][eE]|[uU][nN][iI][FfSsTtCc]|[eE][uU])/g,"a $2"),t=t.replace(/\b(a|an)\s+\1\b/gi,"$1"),t=t.replace(/\b(a|an) +([a-zA-Z\{][\w\{]*)/gi,(o,a,r)=>{const i=r[0].toLowerCase(),n=l.includes(i)&&!r.toLowerCase().startsWith("uni")&&!r.toLowerCase().startsWith("eu")&&!r.toLowerCase().startsWith("one");return a.toLowerCase()==="a"&&n?`an ${r}`:a.toLowerCase()==="an"&&!n?`a ${r}`:o}),t=t.replace(/its (a|an) (\w+ [\w_'-]+) and (its|the) (a|an)? \2/gi,"its $2"),t=t.replace(/its (a|an) (\w+ [\w_'-]+) and \2/gi,"its $2"),t=t.replace(/its (a|an) (\w+) character/gi,"its $2 character"),t=t.replace(/its (a|an) (\w+) essence/gi,"its $2 essence"),t=t.replace(/\bof an? ancient set of an? ancient\b/gi,"of a set of ancient"),t=t.replace(/\b(\w+)\s+\1\b/gi,"$1"),t=t.replace(/a touch of an elegant touch/gi,"an elegant touch"),t.replace(/\s+/g," ").trim()}function le(){document.getElementById("dishName").textContent="Conjuring a new culinary masterpiece...",document.getElementById("dishConcept").textContent="The spirits of the four nations are whispering their secrets...",document.getElementById("ingredientList").innerHTML="",document.getElementById("dishNotes").textContent="Please wait while the elemental kitchens are hard at work.",document.getElementById("dishLore").style.display="none",document.getElementById("dishResult").style.display="block"}function ce(e){const{name:t,concept:l,ingredients:o,notes:a,lore:r}=e;document.getElementById("dishName").textContent=I(t),document.getElementById("dishConcept").textContent=I(l);const i=document.getElementById("ingredientList");i.innerHTML="",o.forEach(n=>{const c=document.createElement("li"),d=n.rarity&&n.rarity!=="common"?`; Rarity: ${n.rarity}`:"";c.textContent=`${n.name} (Role: ${n.role||"unknown"}; Type: ${n.type}; Source: ${n.sourceNation||"Unknown"})${d}`,i.appendChild(c)}),document.getElementById("dishNotes").textContent=I(a),r?(document.getElementById("loreText").textContent=I(r),document.getElementById("dishLore").style.display="block"):document.getElementById("dishLore").style.display="none",document.getElementById("dishResult").style.display="block"}function de(e){document.getElementById("dishName").textContent="A Culinary Mishap!",document.getElementById("dishConcept").textContent="The spirits seem to be in disarray. An error occurred during generation.",document.getElementById("ingredientList").innerHTML="",document.getElementById("dishNotes").textContent=`Error details: ${e.message}. Please check the console for more information.`,document.getElementById("dishLore").style.display="none",document.getElementById("dishResult").style.display="block"}document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("seed");q(e);const t=document.getElementById("generate-btn");if(!t){console.error("CRITICAL ERROR: The button with id 'generate-btn' was not found. Script cannot execute.");return}t.addEventListener("click",l=>{l.preventDefault();const o=document.getElementById("dishTypeInput").value,a=Array.from(document.querySelectorAll("input[name='nation']:checked")).map(n=>n.value),r=document.getElementById("specialThemes").value,i="Default";if(a.length===0){alert("Please select at least one nation!");return}le(),setTimeout(()=>{try{const n=se(o,a,i,r);ce(n)}catch(n){console.error("Error during dish generation:",n),de(n)}},50)})});
